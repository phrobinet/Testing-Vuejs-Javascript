<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue Router | Test in Javascript</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Testing Vuejs and JS">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.ea2dea0c.css" as="style"><link rel="preload" href="/assets/js/app.24bc32f1.js" as="script"><link rel="preload" href="/assets/js/2.76e9c098.js" as="script"><link rel="preload" href="/assets/js/196.a2d7cf41.js" as="script"><link rel="prefetch" href="/assets/js/10.bd6fd6a5.js"><link rel="prefetch" href="/assets/js/100.8b2af6ca.js"><link rel="prefetch" href="/assets/js/101.07acf063.js"><link rel="prefetch" href="/assets/js/102.1929f46a.js"><link rel="prefetch" href="/assets/js/103.901cb352.js"><link rel="prefetch" href="/assets/js/104.08c08b1b.js"><link rel="prefetch" href="/assets/js/105.c87ae376.js"><link rel="prefetch" href="/assets/js/106.b9540579.js"><link rel="prefetch" href="/assets/js/107.c373e56a.js"><link rel="prefetch" href="/assets/js/108.190a5b42.js"><link rel="prefetch" href="/assets/js/109.de77279a.js"><link rel="prefetch" href="/assets/js/11.1abf9ce7.js"><link rel="prefetch" href="/assets/js/110.59279552.js"><link rel="prefetch" href="/assets/js/111.339076a2.js"><link rel="prefetch" href="/assets/js/112.e118dccb.js"><link rel="prefetch" href="/assets/js/113.5c0bd789.js"><link rel="prefetch" href="/assets/js/114.1d668748.js"><link rel="prefetch" href="/assets/js/115.fe28a47f.js"><link rel="prefetch" href="/assets/js/116.85cb9bc4.js"><link rel="prefetch" href="/assets/js/117.5d84ecae.js"><link rel="prefetch" href="/assets/js/118.97071e86.js"><link rel="prefetch" href="/assets/js/119.b1619621.js"><link rel="prefetch" href="/assets/js/12.9cda47c9.js"><link rel="prefetch" href="/assets/js/120.567ed6d6.js"><link rel="prefetch" href="/assets/js/121.45f71502.js"><link rel="prefetch" href="/assets/js/122.4bc1494e.js"><link rel="prefetch" href="/assets/js/123.1fe4d3cd.js"><link rel="prefetch" href="/assets/js/124.813789b6.js"><link rel="prefetch" href="/assets/js/125.0b07623a.js"><link rel="prefetch" href="/assets/js/126.edac2a7b.js"><link rel="prefetch" href="/assets/js/127.98f2f204.js"><link rel="prefetch" href="/assets/js/128.b37a7ef5.js"><link rel="prefetch" href="/assets/js/129.c343c3cb.js"><link rel="prefetch" href="/assets/js/13.85e5e853.js"><link rel="prefetch" href="/assets/js/130.c28fd2d7.js"><link rel="prefetch" href="/assets/js/131.e3da3de8.js"><link rel="prefetch" href="/assets/js/132.1262f0f9.js"><link rel="prefetch" href="/assets/js/133.e4c7b81d.js"><link rel="prefetch" href="/assets/js/134.4f10e5ad.js"><link rel="prefetch" href="/assets/js/135.6d73ee1c.js"><link rel="prefetch" href="/assets/js/136.5704a081.js"><link rel="prefetch" href="/assets/js/137.48982e54.js"><link rel="prefetch" href="/assets/js/138.9467f55e.js"><link rel="prefetch" href="/assets/js/139.ae166ff8.js"><link rel="prefetch" href="/assets/js/14.b9453e71.js"><link rel="prefetch" href="/assets/js/140.fdb98c05.js"><link rel="prefetch" href="/assets/js/141.2a2afcd3.js"><link rel="prefetch" href="/assets/js/142.ad3c4a11.js"><link rel="prefetch" href="/assets/js/143.dacf248f.js"><link rel="prefetch" href="/assets/js/144.33749fca.js"><link rel="prefetch" href="/assets/js/145.95a7d271.js"><link rel="prefetch" href="/assets/js/146.851f988c.js"><link rel="prefetch" href="/assets/js/147.7b397c38.js"><link rel="prefetch" href="/assets/js/148.bfa13c36.js"><link rel="prefetch" href="/assets/js/149.d769487a.js"><link rel="prefetch" href="/assets/js/15.a8754c4f.js"><link rel="prefetch" href="/assets/js/150.f7925a0b.js"><link rel="prefetch" href="/assets/js/151.30fc2417.js"><link rel="prefetch" href="/assets/js/152.da862d56.js"><link rel="prefetch" href="/assets/js/153.05501cee.js"><link rel="prefetch" href="/assets/js/154.13688f7b.js"><link rel="prefetch" href="/assets/js/155.5595f5b5.js"><link rel="prefetch" href="/assets/js/156.4607c511.js"><link rel="prefetch" href="/assets/js/157.8f3520e6.js"><link rel="prefetch" href="/assets/js/158.ed6318c6.js"><link rel="prefetch" href="/assets/js/159.ac08b4df.js"><link rel="prefetch" href="/assets/js/16.95db1a40.js"><link rel="prefetch" href="/assets/js/160.81eedd9c.js"><link rel="prefetch" href="/assets/js/161.d1ecd9fa.js"><link rel="prefetch" href="/assets/js/162.5bc472e3.js"><link rel="prefetch" href="/assets/js/163.5338ad76.js"><link rel="prefetch" href="/assets/js/164.00159e33.js"><link rel="prefetch" href="/assets/js/165.fd12f649.js"><link rel="prefetch" href="/assets/js/166.f5fd8ca2.js"><link rel="prefetch" href="/assets/js/167.0edc1d53.js"><link rel="prefetch" href="/assets/js/168.58447d54.js"><link rel="prefetch" href="/assets/js/169.218ee891.js"><link rel="prefetch" href="/assets/js/17.755e0cd0.js"><link rel="prefetch" href="/assets/js/170.199c205f.js"><link rel="prefetch" href="/assets/js/171.43f89ffb.js"><link rel="prefetch" href="/assets/js/172.5f627aeb.js"><link rel="prefetch" href="/assets/js/173.226d046a.js"><link rel="prefetch" href="/assets/js/174.3b7c1fe6.js"><link rel="prefetch" href="/assets/js/175.7ed848e5.js"><link rel="prefetch" href="/assets/js/176.ed19d38d.js"><link rel="prefetch" href="/assets/js/177.d2e99cd6.js"><link rel="prefetch" href="/assets/js/178.d83769b6.js"><link rel="prefetch" href="/assets/js/179.61302ec9.js"><link rel="prefetch" href="/assets/js/18.b3b0e0e4.js"><link rel="prefetch" href="/assets/js/180.54ae0f5f.js"><link rel="prefetch" href="/assets/js/181.cba0e05c.js"><link rel="prefetch" href="/assets/js/182.ecbbf334.js"><link rel="prefetch" href="/assets/js/183.c3a4205b.js"><link rel="prefetch" href="/assets/js/184.19fdcb7a.js"><link rel="prefetch" href="/assets/js/185.46ebc6f2.js"><link rel="prefetch" href="/assets/js/186.d1e72cee.js"><link rel="prefetch" href="/assets/js/187.87231894.js"><link rel="prefetch" href="/assets/js/188.f0b6fc01.js"><link rel="prefetch" href="/assets/js/189.eb432878.js"><link rel="prefetch" href="/assets/js/19.aabe0e7d.js"><link rel="prefetch" href="/assets/js/190.14b00b81.js"><link rel="prefetch" href="/assets/js/191.3f909bfd.js"><link rel="prefetch" href="/assets/js/192.028860bf.js"><link rel="prefetch" href="/assets/js/193.1b5b2f37.js"><link rel="prefetch" href="/assets/js/194.8d323eea.js"><link rel="prefetch" href="/assets/js/195.f0e12767.js"><link rel="prefetch" href="/assets/js/197.968f03ff.js"><link rel="prefetch" href="/assets/js/198.ef355cb1.js"><link rel="prefetch" href="/assets/js/199.515dd329.js"><link rel="prefetch" href="/assets/js/20.1e7f3f8e.js"><link rel="prefetch" href="/assets/js/200.9a6dac1b.js"><link rel="prefetch" href="/assets/js/201.41cd0115.js"><link rel="prefetch" href="/assets/js/202.ae766aff.js"><link rel="prefetch" href="/assets/js/21.bb911945.js"><link rel="prefetch" href="/assets/js/22.addf865a.js"><link rel="prefetch" href="/assets/js/23.28243e94.js"><link rel="prefetch" href="/assets/js/24.a17de2c4.js"><link rel="prefetch" href="/assets/js/25.02bfc0b8.js"><link rel="prefetch" href="/assets/js/26.cbf75245.js"><link rel="prefetch" href="/assets/js/27.61521ef6.js"><link rel="prefetch" href="/assets/js/28.9325d706.js"><link rel="prefetch" href="/assets/js/29.5805cc76.js"><link rel="prefetch" href="/assets/js/3.7c32fca4.js"><link rel="prefetch" href="/assets/js/30.3bac8758.js"><link rel="prefetch" href="/assets/js/31.d7527875.js"><link rel="prefetch" href="/assets/js/32.c93dd641.js"><link rel="prefetch" href="/assets/js/33.748d0532.js"><link rel="prefetch" href="/assets/js/34.20de348f.js"><link rel="prefetch" href="/assets/js/35.23193db6.js"><link rel="prefetch" href="/assets/js/36.0611c91e.js"><link rel="prefetch" href="/assets/js/37.f7324ef3.js"><link rel="prefetch" href="/assets/js/38.a69f5e3e.js"><link rel="prefetch" href="/assets/js/39.f45216ca.js"><link rel="prefetch" href="/assets/js/4.983f137d.js"><link rel="prefetch" href="/assets/js/40.c6afcce6.js"><link rel="prefetch" href="/assets/js/41.6c902063.js"><link rel="prefetch" href="/assets/js/42.d8e63344.js"><link rel="prefetch" href="/assets/js/43.9cec6759.js"><link rel="prefetch" href="/assets/js/44.5200d14e.js"><link rel="prefetch" href="/assets/js/45.b2a69d52.js"><link rel="prefetch" href="/assets/js/46.c818f64c.js"><link rel="prefetch" href="/assets/js/47.56ff6553.js"><link rel="prefetch" href="/assets/js/48.e2a83d9e.js"><link rel="prefetch" href="/assets/js/49.a4b7c360.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/50.62818f18.js"><link rel="prefetch" href="/assets/js/51.adc8dadf.js"><link rel="prefetch" href="/assets/js/52.8ab1dd65.js"><link rel="prefetch" href="/assets/js/53.4950b2fa.js"><link rel="prefetch" href="/assets/js/54.10d7d06f.js"><link rel="prefetch" href="/assets/js/55.92fb6735.js"><link rel="prefetch" href="/assets/js/56.1ed516ad.js"><link rel="prefetch" href="/assets/js/57.7d01fe08.js"><link rel="prefetch" href="/assets/js/58.c5c2b239.js"><link rel="prefetch" href="/assets/js/59.24cf9a09.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.e955341b.js"><link rel="prefetch" href="/assets/js/61.5cac46d9.js"><link rel="prefetch" href="/assets/js/62.13cba836.js"><link rel="prefetch" href="/assets/js/63.779e4489.js"><link rel="prefetch" href="/assets/js/64.8772eb9a.js"><link rel="prefetch" href="/assets/js/65.c36159d8.js"><link rel="prefetch" href="/assets/js/66.1c1067aa.js"><link rel="prefetch" href="/assets/js/67.c8fcf10f.js"><link rel="prefetch" href="/assets/js/68.68cd681c.js"><link rel="prefetch" href="/assets/js/69.c11cf74a.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/70.cd1c6d9c.js"><link rel="prefetch" href="/assets/js/71.7a58fc57.js"><link rel="prefetch" href="/assets/js/72.d4818f32.js"><link rel="prefetch" href="/assets/js/73.1d2fa4b2.js"><link rel="prefetch" href="/assets/js/74.c78932fc.js"><link rel="prefetch" href="/assets/js/75.d4d78c9d.js"><link rel="prefetch" href="/assets/js/76.899208f6.js"><link rel="prefetch" href="/assets/js/77.d7a98769.js"><link rel="prefetch" href="/assets/js/78.f38bbb92.js"><link rel="prefetch" href="/assets/js/79.21960021.js"><link rel="prefetch" href="/assets/js/8.aef0e204.js"><link rel="prefetch" href="/assets/js/80.98ce429f.js"><link rel="prefetch" href="/assets/js/81.9bea15a0.js"><link rel="prefetch" href="/assets/js/82.cf27c952.js"><link rel="prefetch" href="/assets/js/83.10352c38.js"><link rel="prefetch" href="/assets/js/84.8a6fab2c.js"><link rel="prefetch" href="/assets/js/85.ee9987ed.js"><link rel="prefetch" href="/assets/js/86.f89fad1c.js"><link rel="prefetch" href="/assets/js/87.44e47fe2.js"><link rel="prefetch" href="/assets/js/88.0863542b.js"><link rel="prefetch" href="/assets/js/89.928a3042.js"><link rel="prefetch" href="/assets/js/9.2250d602.js"><link rel="prefetch" href="/assets/js/90.ea6b407d.js"><link rel="prefetch" href="/assets/js/91.6e31a37f.js"><link rel="prefetch" href="/assets/js/92.f60fcb9f.js"><link rel="prefetch" href="/assets/js/93.3796cd61.js"><link rel="prefetch" href="/assets/js/94.fb3ea4ad.js"><link rel="prefetch" href="/assets/js/95.799e542d.js"><link rel="prefetch" href="/assets/js/96.207d2648.js"><link rel="prefetch" href="/assets/js/97.66fdd036.js"><link rel="prefetch" href="/assets/js/98.62e80ae4.js"><link rel="prefetch" href="/assets/js/99.b6f9c026.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea2dea0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Test in Javascript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link router-link-active">
  Vue-testing-handbook
</a></div><div class="nav-item"><a href="/jest/" class="nav-link">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link router-link-active">
  Vue-testing-handbook
</a></div><div class="nav-item"><a href="/jest/" class="nav-link">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Manuel sur les tests de vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue-testing-handbook/" aria-current="page" class="sidebar-link">Qu'est-ce que ce guide ?</a></li><li><a href="/vue-testing-handbook/setting-up-for-tdd.html" class="sidebar-link">Mise en place pour tdd</a></li><li><a href="/vue-testing-handbook/rendering-a-component.html" class="sidebar-link">Rendre un composant</a></li><li><a href="/vue-testing-handbook/wrapper.html" class="sidebar-link">Les méthodes avec wrapper</a></li><li><a href="/vue-testing-handbook/components-with-props.html" class="sidebar-link">Les composants avec props</a></li><li><a href="/vue-testing-handbook/computed-properties.html" class="sidebar-link">Les propiétés calculées</a></li><li><a href="/vue-testing-handbook/simulating-user-input.html" class="sidebar-link">Simuler la saisie utilisateur</a></li><li><a href="/vue-testing-handbook/testing-emitted-events.html" class="sidebar-link">Test des éléments émis</a></li><li><a href="/vue-testing-handbook/mocking-global-objects.html" class="sidebar-link">Simuler les objets globaux</a></li><li><a href="/vue-testing-handbook/stubbing-components.html" class="sidebar-link">Les composants stub</a></li><li><a href="/vue-testing-handbook/finding-elements-and-components.html" class="sidebar-link">Trouver les éléments et les composants</a></li><li><a href="/vue-testing-handbook/testing-vuex.html" class="sidebar-link">Tester Vuex</a></li><li><a href="/vue-testing-handbook/vuex-mutations.html" class="sidebar-link">Les mutations de Vuex</a></li><li><a href="/vue-testing-handbook/vuex-actions.html" class="sidebar-link">Les actions de Vuex</a></li><li><a href="/vue-testing-handbook/vuex-getters.html" class="sidebar-link">Les getteres de Vuex</a></li><li><a href="/vue-testing-handbook/vuex-in-components.html" class="sidebar-link">Vuex dans les composants</a></li><li><a href="/vue-testing-handbook/vuex-in-components-mutations-and-actions.html" class="sidebar-link">Vuex dans les mutations et les actions des composants </a></li><li><a href="/vue-testing-handbook/vue-router.html" aria-current="page" class="active sidebar-link">Vue Router</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#vue-router" class="sidebar-link">Vue Router</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#la-creation-de-composants" class="sidebar-link">La création de composants</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#la-creation-de-router-et-de-routes" class="sidebar-link">La création de Router et de Routes</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#l-ecriture-du-test" class="sidebar-link">L'écriture du Test</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#la-solution-pour-les-grandes-arborescences-en-utilisant-mount" class="sidebar-link">La solution pour les grandes arborescences en utilisant mount</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#l-utilisation-d-un-faux-router" class="sidebar-link">L'utilisation d'un faux router</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#les-strategies-pour-tester-les-hooks-de-router" class="sidebar-link">Les Stratégies pour tester les Hooks de Router</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#les-intercepteurs-globaux" class="sidebar-link">Les Intercepteurs Globaux</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#interception-par-composant" class="sidebar-link">Interception par composant</a></li><li class="sidebar-sub-header"><a href="/vue-testing-handbook/vue-router.html#conclusion" class="sidebar-link">Conclusion</a></li></ul></li><li><a href="/vue-testing-handbook/composition-api.html" class="sidebar-link">Composition de l'API</a></li><li><a href="/vue-testing-handbook/reducing-boilerplate-in-tests.html" class="sidebar-link">Réduction standard dans les tests</a></li><li><a href="/vue-testing-handbook/jest-mocking-modules.html" class="sidebar-link">Les modules de simulations de Jest</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> Vue Router</h2> <p>Étant donné qu'un routeur comporte généralement plusieurs composants fonctionnant ensemble, les tests de routage ont souvent lieu plus haut dans la <a href="https://medium.freecodecamp.org/the-front-end-test-pyramid-rethink-your-testing-3b343c2bca51" target="_blank" rel="noopener noreferrer">pyramide de tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, au niveau des tests de  e2e/intégration. Cependant, avoir des tests unitaires autour de votre routeur peut être bénéfique.</p> <p>Tout comme les sections précédentes, il existe deux façons de tester les composants qui interagissent avec un routeur :</p> <ol><li>En utilisant une instance réelle de routeur.</li> <li>En simulant des objets globaux de <code>$route</code> et de <code>$router</code>.</li></ol> <p>Comme la plupart des applications Vue utilisent le routeur Vue officiel, ce guide se concentrera sur ce point.</p> <p>Le code source du test décrit sur cette page peut être trouvé <a href="https://github.com/lmiller1990/vue-testing-handbook/tree/master/demo-app/tests/unit/App.spec.js" target="_blank" rel="noopener noreferrer">ici<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et <a href="https://github.com/lmiller1990/vue-testing-handbook/tree/master/demo-app/tests/unit/NestedRoute.spec.js" target="_blank" rel="noopener noreferrer">ici<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="la-creation-de-composants"><a href="#la-creation-de-composants" class="header-anchor">#</a> La création de composants</h2> <p>Nous allons construire un simple <code>&lt;App&gt;</code> qui a une route <code>/nested-child</code>. Quand nous nous rendons sur <code>nested_child</code> on nous rend un composant <code>&lt;NestedRoute&gt;</code>. Créez un fichier <code>App.vue</code> et insérez le composant minimal suivant :</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'app'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>&lt;NestedRoute&gt;</code> est tout aussi minimal :</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Nested Route<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;NestedRoute&quot;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="la-creation-de-router-et-de-routes"><a href="#la-creation-de-router-et-de-routes" class="header-anchor">#</a> La création de Router et de Routes</h2> <p>Maintenant il nous faut des routes à tester. Commençons par les routes :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;/nested-route&quot;</span><span class="token punctuation">,</span> component<span class="token operator">:</span> NestedRoute <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>Dans une application réelle, vous devez normalement créez un fichier <code>router.js</code>, importer les routes que vous avez faites et écrire quelque chose comme ceci :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./routes.js&quot;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Comme nous ne voulons pas polluer le namespace par des appels <code>Vue.use()</code>dans nos tests, nous allons créer le router pour notre test. Cela nous permettra d'avoir un contrôle lus fin sur l'état de l'application pendant les tests unitaires.</p> <h2 id="l-ecriture-du-test"><a href="#l-ecriture-du-test" class="header-anchor">#</a> L'écriture du Test</h2> <p>Examinons le code, puis nous parlerons de ce qui se passe. Nous testons <code>App.vue</code>, donc dans <code>App.spec.js</code>ajoutez ce qui suit :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> mount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;@/App.vue&quot;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>
<span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;@/routes.js&quot;</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders a child component via routing&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      localVue<span class="token punctuation">,</span>
      router
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/nested-route&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>Notez que les tests sont indiqués comme <code>await</code> et appelez par <code>nextTick</code>. Regardez <a href="/simulating-user-input.html#writing-the-test">ici</a> afin d'avoir plus de détails sur le pourquoi.</li></ul> <p>Comme d'habitude, nous commençons par importer les différents modules pour le test. Notamment, nous importons les routes réelles que nous utiliserons pour l'application. C'est une bonne façon - si le routage réel échoue, les tests unitaires devraient échouer, ce qui nous permet de régler le problème avant de déployer l'application.</p> <p>Nous pouvons utiliser le même <code>localVue</code>pour tout le test de l'<code>App.vue</code>, donc nous allons le déclarer en dehors du premier bloc <code>describe</code>. Cependant, comme nous souhaitons avoir des différents tests sur différentes routes, la solution n'est pas aussi simple que de définir le router à l'intérieur du bloc <code>it</code>.</p> <p>Même si vous placez le router à l'intérieur du clic <code>it</code>, il pointera toujours la route précédente. Vous pouvez essayer l’exemple ci-dessous :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount<span class="token punctuation">,</span> mount<span class="token punctuation">,</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;@/App.vue&quot;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>
<span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;@/routes.js&quot;</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders a child component via routing&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      localVue<span class="token punctuation">,</span>
      router
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/nested-route&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should have a different route that /nested-route&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      localVue<span class="token punctuation">,</span>
      router
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// This test will fail because we are still on the /nested-route</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>currentRoute<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>La solution est de définir le mode <strong>history</strong> ou <strong>abstract</strong>.</p> <div class="language-vue extra-class"><pre class="language-vue"><code>const router = new VueRouter({ routes, mode: 'abstract' });
</code></pre></div><p>Maintenant la route actuelle sera la route home.</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> '/'<span class="token punctuation">,</span>
      hash<span class="token operator">:</span> ''<span class="token punctuation">,</span>
      query<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      params<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      fullPath<span class="token operator">:</span> '/'<span class="token punctuation">,</span>
      matched<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Un autre point notable qui est différent des autres articles de ce livre est de l'utilisation de <code>mount</code> à la place de <code>shallowMount</code>. Si nous utilisons <code>shallowMount</code>, <code>&lt;routee-link&gt;</code>sera tronqué, quel que soit le chemin actuel, un composant tronqué inutile sera rendu.</p> <h2 id="la-solution-pour-les-grandes-arborescences-en-utilisant-mount"><a href="#la-solution-pour-les-grandes-arborescences-en-utilisant-mount" class="header-anchor">#</a> La solution pour les grandes arborescences en utilisant <code>mount</code></h2> <p>L'utilisation de <code>mount</code> est bonne dans certains cas, ais parfois elle n'est pas idéale. Par exemple, si vous rendez l'intégralité du composant <code>&lt;App&gt;</code>, il y a de fortes chances que l'arborescence soit très étendu, avec beaucoup de composants qui ont leurs propres composants enfants, etc. Beaucoup des composants enfants déclenchent divers cycles de vie des hooks, en faisant des requêtes API et autres.</p> <p>Si vous utilisez Jest, son puissant système de simulations fournit une solution élégante à ce problème. Vous pouvez simplement simuler des composants enfants, dans notre cas <code>&lt;NestedRoute&gt;</code>. La simulation suivante peut être utilisé et le test suivant sera toujours réussi :</p> <div class="language-js extra-class"><pre class="language-js"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;@/components/NestedRoute.vue&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;NestedRoute&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="l-utilisation-d-un-faux-router"><a href="#l-utilisation-d-un-faux-router" class="header-anchor">#</a> L'utilisation d'un faux router</h2> <p>Des fois un réel router n'est pas nécessaire. Modifiez <code>&lt;NesetedRoute&gt;</code> pour qu'il montre le nom d'utilisateur qui est dans la chaîne de requête de la route. Cette fois, nous utiliserons le TDD pour implémenter la fonctionnalité. Voici un test de base qui rend simplement le composant et fait une assertion :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span>
<span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;@/routes.js&quot;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;NestedRoute&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders a username from query string&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token string">&quot;alice&quot;</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Nous n'avons pas encore <code>&lt;div class=&quot;username&quot;&gt;</code>, donc le test échoue :</p> <div class="language- extra-class"><pre class="language-text"><code>FAIL  tests/unit/NestedRoute.spec.js
  NestedRoute
    ✕ renders a username from query string (25ms)

  ● NestedRoute › renders a username from query string

    [vue-test-utils]: find did not return .username, cannot call text() on empty Wrapper
</code></pre></div><p>Modifiez <code>&lt;NestedRoute&gt;</code>:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    Nested Route
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      {{ $route.params.username }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Maintenant le test échoue avec comme message :</p> <div class="language- extra-class"><pre class="language-text"><code>FAIL  tests/unit/NestedRoute.spec.js
  NestedRoute
    ✕ renders a username from query string (17ms)

  ● NestedRoute › renders a username from query string

    TypeError: Cannot read property 'params' of undefined
</code></pre></div><p>C'est parce que <code>$route</code> n'existe pas encore. Nous pouvons utiliser un vrai router, mais dans ce cas cela sera plus facile d'utiliser l'option de montage <code>mocks</code> :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;renders a username from query string&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token string">&quot;alice&quot;</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    mocks<span class="token operator">:</span> <span class="token punctuation">{</span>
      $route<span class="token operator">:</span> <span class="token punctuation">{</span>
        params<span class="token operator">:</span> <span class="token punctuation">{</span> username <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Maintenant le test passes. Dans ce cas, nous n'avons pas de navigation ou rien qui repose sur l'implémentation du router, donc l'utilisation de <code>mock</code> est bonne. Nous ne nous soucions pas vraiment de la façon dont l'<code>username</code> se trouve dans la chaîne de requête de la route mais seulement de sa présence.</p> <p>Souvent le serveur va fournir le routage, par opposition au routage côté client avec Vue Router. Sans de tels cas, l'utilisation de <code>mock</code> pour définir la chaîne de requête dans un test est une bonne alternative à l'utilisation d'une réelle instance de Vue Router.</p> <h2 id="les-strategies-pour-tester-les-hooks-de-router"><a href="#les-strategies-pour-tester-les-hooks-de-router" class="header-anchor">#</a> Les Stratégies pour tester les Hooks de Router</h2> <p>Vue Router fournit plusieurs types de hooks de routeur, ce référer <a href="https://router.vuejs.org/guide/advanced/navigation-guards.html" target="_blank" rel="noopener noreferrer">&quot;navigation guards&quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. En voici deux exemples:</p> <ol><li>Les intercepteurs globaux (<code>router.beforeEach</code>). Déclarés sur l'instance du routeur.</li> <li>Dans les composants d'interception, comme <code>beforeRouteEnter</code>. Déclaré dans les composants.</li></ol> <p>S'assurer que ceux-ci se comportent correctement est généralement une tâche pour un test d'intégration, puisque vous devez faire naviguer un utilisateur d'une route à l'autre. Cependant vous pouvez également utiliser des tests unitaires pour vois si les fonctions appelées dans les intercepteurs de navigation fonction correctement et de récupérer facilement un retour sur des bugs potentiels. Voici quelques stratégies pour découpler la logique des intercepteurs de navigation et écrire des tests unitaires autour d'eux.</p> <h2 id="les-intercepteurs-globaux"><a href="#les-intercepteurs-globaux" class="header-anchor">#</a> Les Intercepteurs Globaux</h2> <p>Supposons que vous ayez une fonction <code>bustCache</code> qui doit être appelez sur chaque route qui contient le méta-champ <code>shouldBustCache</code>. Vos routes devraient ressembler à ceci :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">&quot;/nested-route&quot;</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> NestedRoute<span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      shouldBustCache<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>En utilisant le méta-champ <code>shouldBustCache</code>, vous voulez invalidez le cache actuel afin de vous assurer que l'utilisateur n'obtienne pas de données périmées. Une implémentation devrait ressembler à ceci :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./routes.js&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bustCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./bust-cache.js&quot;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes <span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>shouldBustCache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">bustCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre></div><p>Dans votre test unitaire, vous <strong>pourriez</strong> importez l'instance de la routeur et tenter d'appeler <code>beforeEach</code> en tapant <code>router.beforeHooks[0]()</code>. Cela provoquera une erreur sur <code>next</code> - puisque vous n'avez pas passé les bons arguments. Au lieu de cela, une stratégie consiste à découper et exporter indépendamment le hook de navigation <code>beforeEach</code> avant de le coupler au router. Et pourquoi pas :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=&gt;</span> record<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>shouldBustCache<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">bustCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">beforeEach</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router
</code></pre></div><p>Maintenant écrire un test est plus facile, même s'il est un peu long :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> beforeEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/router.js&quot;</span>
<span class="token keyword">import</span> mockModule <span class="token keyword">from</span> <span class="token string">&quot;@/bust-cache.js&quot;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;@/bust-cache.js&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> bustCache<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;beforeEach&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    mockModule<span class="token punctuation">.</span>bustCache<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;busts the cache when going to /user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> to <span class="token operator">=</span> <span class="token punctuation">{</span>
      matched<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> meta<span class="token operator">:</span> <span class="token punctuation">{</span> shouldBustCache<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">beforeEach</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>mockModule<span class="token punctuation">.</span>bustCache<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;does not bust the cache when going to /user&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> to <span class="token operator">=</span> <span class="token punctuation">{</span>
      matched<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> meta<span class="token operator">:</span> <span class="token punctuation">{</span> shouldBustCache<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">beforeEach</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>mockModule<span class="token punctuation">.</span>bustCache<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Le point intéressant est que nous avons simuler un module entier en utilisant <code>jest.mock</code>,  et que nous réinitialisons la simulation en utilisant le hook <code>afterEach</code>. En exportant le <code>beforeEach</code> comme une fonction Javascript découpée et régulière, il devient trivial de le tester.</p> <p>Pour être sûr que le hook appel réellement <code>bustCache</code> et d'afficher les données	les plus récentes, on peut utiliser un outil de test e2e comme <a href="https://www.cypress.io/" target="_blank" rel="noopener noreferrer">Cypress.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, qui est fourni avec les applications échafauder avec vue-cli.</p> <h2 id="interception-par-composant"><a href="#interception-par-composant" class="header-anchor">#</a> Interception par composant</h2> <p>Les interceptions par composant sont aussi faciles à tester, une fois que vous les voyez comme des fonctions Javascript découplées et régulières. Supposons que vous ajoutez un hook <code>beforeRouteLeave</code> à <code>&lt;NestedRoute&gt;</code> :</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> bustCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/bust-cache.js&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;NestedRoute&quot;</span><span class="token punctuation">,</span>

  <span class="token function">beforeRouteLeave</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">bustCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Nous pouvons le tester exactement de la même manière que l'intercepteur global :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">import</span> NestedRoute <span class="token keyword">from</span> <span class="token string">&quot;@/components/NestedRoute.vue&quot;</span>
<span class="token keyword">import</span> mockModule <span class="token keyword">from</span> <span class="token string">&quot;@/bust-cache.js&quot;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;@/bust-cache.js&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> bustCache<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;calls bustCache and next when leaving the route&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>NestedRoute<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> next <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  NestedRoute<span class="token punctuation">.</span><span class="token function">beforeRouteLeave</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span>
  <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


  <span class="token function">expect</span><span class="token punctuation">(</span>mockModule<span class="token punctuation">.</span>bustCache<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Bien que ce style de test unitaire puisse être utile pour avoir un retour d'information immédiat pendant le développement, puisque les routeurs et les hooks de navigation interagissent souvent avec plusieurs composants pour obtenir un certain effet, vous devriez aussi disposer de tests d'intégration pour vous assurer que tout fonctionne correctement.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>Ce guide couvre :</p> <ul><li>Le test conditionnel de composant rendu par Vue Router.</li> <li>La simulation de composant Vue utilisant <code>jest.mock</code> et <code>localVue</code>.</li> <li>Le découplage de l'interception de la navigation global du routeur en le testant indépendamment.</li> <li>L'utilisation de <code>jest.mock</code>pour simuler un module.</li></ul> <p>Le code source du test décrit sur cette page peut être trouvé <a href="https://github.com/lmiller1990/vue-testing-handbook/tree/master/demo-app/tests/unit/App.spec.js" target="_blank" rel="noopener noreferrer">ici<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> et <a href="https://github.com/lmiller1990/vue-testing-handbook/tree/master/demo-app/tests/unit/NestedRoute.spec.js" target="_blank" rel="noopener noreferrer">ici<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue-testing-handbook/vuex-in-components-mutations-and-actions.html" class="prev">
        Vuex dans les mutations et les actions des composants 
      </a></span> <span class="next"><a href="/vue-testing-handbook/composition-api.html">
        Composition de l'API
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.24bc32f1.js" defer></script><script src="/assets/js/2.76e9c098.js" defer></script><script src="/assets/js/196.a2d7cf41.js" defer></script>
  </body>
</html>
