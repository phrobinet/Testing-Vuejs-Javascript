<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Manual Mocks | Test in Javascript</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Testing Vuejs and JS">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f1075b4d.css" as="style"><link rel="preload" href="/assets/js/app.1dfb11b9.js" as="script"><link rel="preload" href="/assets/js/2.76e9c098.js" as="script"><link rel="preload" href="/assets/js/22.68cd31e9.js" as="script"><link rel="prefetch" href="/assets/js/10.bd6fd6a5.js"><link rel="prefetch" href="/assets/js/100.e4707484.js"><link rel="prefetch" href="/assets/js/101.e6d01fe0.js"><link rel="prefetch" href="/assets/js/102.03e4577c.js"><link rel="prefetch" href="/assets/js/103.533425bb.js"><link rel="prefetch" href="/assets/js/104.7866060c.js"><link rel="prefetch" href="/assets/js/105.c87ae376.js"><link rel="prefetch" href="/assets/js/106.1470de17.js"><link rel="prefetch" href="/assets/js/107.31d6eb75.js"><link rel="prefetch" href="/assets/js/108.8ab8ef28.js"><link rel="prefetch" href="/assets/js/109.f31541ff.js"><link rel="prefetch" href="/assets/js/11.1abf9ce7.js"><link rel="prefetch" href="/assets/js/110.7b3f1636.js"><link rel="prefetch" href="/assets/js/111.2f2eac6f.js"><link rel="prefetch" href="/assets/js/112.e118dccb.js"><link rel="prefetch" href="/assets/js/113.a8a30aa2.js"><link rel="prefetch" href="/assets/js/114.c9cd627f.js"><link rel="prefetch" href="/assets/js/115.a4796295.js"><link rel="prefetch" href="/assets/js/116.85cb9bc4.js"><link rel="prefetch" href="/assets/js/117.9857c369.js"><link rel="prefetch" href="/assets/js/118.fdd75f70.js"><link rel="prefetch" href="/assets/js/119.480af062.js"><link rel="prefetch" href="/assets/js/12.48bd50ee.js"><link rel="prefetch" href="/assets/js/120.0903be09.js"><link rel="prefetch" href="/assets/js/121.9e357b85.js"><link rel="prefetch" href="/assets/js/122.809a4b0c.js"><link rel="prefetch" href="/assets/js/123.e2038edd.js"><link rel="prefetch" href="/assets/js/124.4af8a9cc.js"><link rel="prefetch" href="/assets/js/125.b77a97ef.js"><link rel="prefetch" href="/assets/js/126.82f59f13.js"><link rel="prefetch" href="/assets/js/127.f41bdaff.js"><link rel="prefetch" href="/assets/js/128.5fca6b14.js"><link rel="prefetch" href="/assets/js/129.59147136.js"><link rel="prefetch" href="/assets/js/13.85e5e853.js"><link rel="prefetch" href="/assets/js/130.01fec4c9.js"><link rel="prefetch" href="/assets/js/131.bf32c3d1.js"><link rel="prefetch" href="/assets/js/132.5072c74e.js"><link rel="prefetch" href="/assets/js/133.e85de282.js"><link rel="prefetch" href="/assets/js/134.402e4e27.js"><link rel="prefetch" href="/assets/js/135.6dd89c1c.js"><link rel="prefetch" href="/assets/js/136.22ed1db4.js"><link rel="prefetch" href="/assets/js/137.72ab073c.js"><link rel="prefetch" href="/assets/js/138.c39958ee.js"><link rel="prefetch" href="/assets/js/139.1aa20bea.js"><link rel="prefetch" href="/assets/js/14.330cbcd9.js"><link rel="prefetch" href="/assets/js/140.c4b7b7a6.js"><link rel="prefetch" href="/assets/js/141.00a6b127.js"><link rel="prefetch" href="/assets/js/142.dc56159a.js"><link rel="prefetch" href="/assets/js/143.56bf7306.js"><link rel="prefetch" href="/assets/js/144.dc28faf5.js"><link rel="prefetch" href="/assets/js/145.58f42865.js"><link rel="prefetch" href="/assets/js/146.cdf5ac64.js"><link rel="prefetch" href="/assets/js/147.55bfcbbc.js"><link rel="prefetch" href="/assets/js/148.80f92bd1.js"><link rel="prefetch" href="/assets/js/149.d769487a.js"><link rel="prefetch" href="/assets/js/15.425a725c.js"><link rel="prefetch" href="/assets/js/150.f7925a0b.js"><link rel="prefetch" href="/assets/js/151.6218c5b9.js"><link rel="prefetch" href="/assets/js/152.41b5cfa0.js"><link rel="prefetch" href="/assets/js/153.05501cee.js"><link rel="prefetch" href="/assets/js/154.e86f3b62.js"><link rel="prefetch" href="/assets/js/155.1c63407d.js"><link rel="prefetch" href="/assets/js/156.c045d5cd.js"><link rel="prefetch" href="/assets/js/157.f6cea34d.js"><link rel="prefetch" href="/assets/js/158.7a808c51.js"><link rel="prefetch" href="/assets/js/159.b3b4561c.js"><link rel="prefetch" href="/assets/js/16.2062fdae.js"><link rel="prefetch" href="/assets/js/160.9d1f6278.js"><link rel="prefetch" href="/assets/js/161.cf4ec401.js"><link rel="prefetch" href="/assets/js/162.0047afe1.js"><link rel="prefetch" href="/assets/js/163.68d2b64d.js"><link rel="prefetch" href="/assets/js/164.ff770c4d.js"><link rel="prefetch" href="/assets/js/165.15d44e1b.js"><link rel="prefetch" href="/assets/js/166.0ffccc31.js"><link rel="prefetch" href="/assets/js/167.74e5cb83.js"><link rel="prefetch" href="/assets/js/168.3e987bc6.js"><link rel="prefetch" href="/assets/js/169.58a1c121.js"><link rel="prefetch" href="/assets/js/17.8ae89c4b.js"><link rel="prefetch" href="/assets/js/170.f5eb4958.js"><link rel="prefetch" href="/assets/js/171.de2ac02b.js"><link rel="prefetch" href="/assets/js/172.e723173f.js"><link rel="prefetch" href="/assets/js/173.ebe3373d.js"><link rel="prefetch" href="/assets/js/174.754bc705.js"><link rel="prefetch" href="/assets/js/175.68256c4c.js"><link rel="prefetch" href="/assets/js/176.0f54fcc6.js"><link rel="prefetch" href="/assets/js/177.eca24763.js"><link rel="prefetch" href="/assets/js/178.a53fc0b4.js"><link rel="prefetch" href="/assets/js/179.76c93623.js"><link rel="prefetch" href="/assets/js/18.2d051dd7.js"><link rel="prefetch" href="/assets/js/180.89a3951a.js"><link rel="prefetch" href="/assets/js/181.5545787b.js"><link rel="prefetch" href="/assets/js/182.44e30a17.js"><link rel="prefetch" href="/assets/js/183.98f27b20.js"><link rel="prefetch" href="/assets/js/184.8440af44.js"><link rel="prefetch" href="/assets/js/185.000aeddf.js"><link rel="prefetch" href="/assets/js/186.d6b8251b.js"><link rel="prefetch" href="/assets/js/187.31fa426e.js"><link rel="prefetch" href="/assets/js/188.58ccf322.js"><link rel="prefetch" href="/assets/js/189.c2ecd64b.js"><link rel="prefetch" href="/assets/js/19.7680ca75.js"><link rel="prefetch" href="/assets/js/190.6585dda4.js"><link rel="prefetch" href="/assets/js/191.ac09d6be.js"><link rel="prefetch" href="/assets/js/192.569eadde.js"><link rel="prefetch" href="/assets/js/193.dbc5d0c3.js"><link rel="prefetch" href="/assets/js/194.1ed49f10.js"><link rel="prefetch" href="/assets/js/195.73d17c86.js"><link rel="prefetch" href="/assets/js/196.38585136.js"><link rel="prefetch" href="/assets/js/197.80be5379.js"><link rel="prefetch" href="/assets/js/198.d2983630.js"><link rel="prefetch" href="/assets/js/199.c5b0eaae.js"><link rel="prefetch" href="/assets/js/20.92722f5a.js"><link rel="prefetch" href="/assets/js/200.d293a5ee.js"><link rel="prefetch" href="/assets/js/201.845153bc.js"><link rel="prefetch" href="/assets/js/202.c1a3aeac.js"><link rel="prefetch" href="/assets/js/203.fe05addc.js"><link rel="prefetch" href="/assets/js/21.be6446d5.js"><link rel="prefetch" href="/assets/js/23.bdf61bc1.js"><link rel="prefetch" href="/assets/js/24.53cdec02.js"><link rel="prefetch" href="/assets/js/25.ebc52990.js"><link rel="prefetch" href="/assets/js/26.6c0a0e32.js"><link rel="prefetch" href="/assets/js/27.47a1acf9.js"><link rel="prefetch" href="/assets/js/28.9325d706.js"><link rel="prefetch" href="/assets/js/29.5805cc76.js"><link rel="prefetch" href="/assets/js/3.55e527b8.js"><link rel="prefetch" href="/assets/js/30.c432e70c.js"><link rel="prefetch" href="/assets/js/31.3b720485.js"><link rel="prefetch" href="/assets/js/32.8badbdd6.js"><link rel="prefetch" href="/assets/js/33.748d0532.js"><link rel="prefetch" href="/assets/js/34.c3eda56a.js"><link rel="prefetch" href="/assets/js/35.71847246.js"><link rel="prefetch" href="/assets/js/36.0611c91e.js"><link rel="prefetch" href="/assets/js/37.ba71a4af.js"><link rel="prefetch" href="/assets/js/38.ac6f30d4.js"><link rel="prefetch" href="/assets/js/39.58ba7a9e.js"><link rel="prefetch" href="/assets/js/4.bf905f50.js"><link rel="prefetch" href="/assets/js/40.26590aff.js"><link rel="prefetch" href="/assets/js/41.694f8d58.js"><link rel="prefetch" href="/assets/js/42.2d7d8d44.js"><link rel="prefetch" href="/assets/js/43.9cec6759.js"><link rel="prefetch" href="/assets/js/44.f7719b56.js"><link rel="prefetch" href="/assets/js/45.939a097b.js"><link rel="prefetch" href="/assets/js/46.9eb035b4.js"><link rel="prefetch" href="/assets/js/47.717699f5.js"><link rel="prefetch" href="/assets/js/48.e2a83d9e.js"><link rel="prefetch" href="/assets/js/49.0f4a38a5.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/50.09b9cedf.js"><link rel="prefetch" href="/assets/js/51.ca236e5a.js"><link rel="prefetch" href="/assets/js/52.8ab1dd65.js"><link rel="prefetch" href="/assets/js/53.4950b2fa.js"><link rel="prefetch" href="/assets/js/54.6c28a1ae.js"><link rel="prefetch" href="/assets/js/55.203bfda1.js"><link rel="prefetch" href="/assets/js/56.feea9280.js"><link rel="prefetch" href="/assets/js/57.bbd935c4.js"><link rel="prefetch" href="/assets/js/58.98b7e31b.js"><link rel="prefetch" href="/assets/js/59.11977924.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.fef4549b.js"><link rel="prefetch" href="/assets/js/61.5cac46d9.js"><link rel="prefetch" href="/assets/js/62.96cd90d5.js"><link rel="prefetch" href="/assets/js/63.66c5a79a.js"><link rel="prefetch" href="/assets/js/64.57532410.js"><link rel="prefetch" href="/assets/js/65.d081c48d.js"><link rel="prefetch" href="/assets/js/66.cfb836a0.js"><link rel="prefetch" href="/assets/js/67.7b4dd45f.js"><link rel="prefetch" href="/assets/js/68.e7ebbee9.js"><link rel="prefetch" href="/assets/js/69.68324175.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/70.27518c57.js"><link rel="prefetch" href="/assets/js/71.7a58fc57.js"><link rel="prefetch" href="/assets/js/72.08c01f3b.js"><link rel="prefetch" href="/assets/js/73.1d2fa4b2.js"><link rel="prefetch" href="/assets/js/74.a06f107c.js"><link rel="prefetch" href="/assets/js/75.ac9e2bd1.js"><link rel="prefetch" href="/assets/js/76.899208f6.js"><link rel="prefetch" href="/assets/js/77.0f1d0c65.js"><link rel="prefetch" href="/assets/js/78.8a73a4c3.js"><link rel="prefetch" href="/assets/js/79.e2db69cb.js"><link rel="prefetch" href="/assets/js/8.d194c183.js"><link rel="prefetch" href="/assets/js/80.b61d7063.js"><link rel="prefetch" href="/assets/js/81.a82b5e62.js"><link rel="prefetch" href="/assets/js/82.9a5b8058.js"><link rel="prefetch" href="/assets/js/83.10352c38.js"><link rel="prefetch" href="/assets/js/84.ccacae49.js"><link rel="prefetch" href="/assets/js/85.ee9987ed.js"><link rel="prefetch" href="/assets/js/86.f89fad1c.js"><link rel="prefetch" href="/assets/js/87.44e47fe2.js"><link rel="prefetch" href="/assets/js/88.94dfbf30.js"><link rel="prefetch" href="/assets/js/89.04227930.js"><link rel="prefetch" href="/assets/js/9.2250d602.js"><link rel="prefetch" href="/assets/js/90.7a82ea28.js"><link rel="prefetch" href="/assets/js/91.4a625cbe.js"><link rel="prefetch" href="/assets/js/92.29d2fcc3.js"><link rel="prefetch" href="/assets/js/93.3223892e.js"><link rel="prefetch" href="/assets/js/94.7584ac0d.js"><link rel="prefetch" href="/assets/js/95.75db5c06.js"><link rel="prefetch" href="/assets/js/96.bf62c5a6.js"><link rel="prefetch" href="/assets/js/97.66fdd036.js"><link rel="prefetch" href="/assets/js/98.c9d329be.js"><link rel="prefetch" href="/assets/js/99.b6f9c026.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1075b4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Test in Javascript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest/" aria-current="page" class="sidebar-link">Jest</a></li><li><a href="/jest/introduction.html" class="sidebar-link">Pour commencer</a></li><li><a href="/jest/guides.html" class="sidebar-link">Tests instantanés</a></li><li><a href="/jest/framework.html" class="sidebar-link">Tester les Apps React</a></li><li><a href="/jest/api.html" class="sidebar-link">Les api générales</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="simulation-manuelle"><a href="#simulation-manuelle" class="header-anchor">#</a> Simulation manuelle</h1> <p>Des simulations manuelles sont utilisées pour masquer les fonctionnalités à l'aide de données fictives. Par exemple, au lieu d'accéder à une ressource distante comme un site web ou une base de données, vous pouvez créer une simulation manuelle qui vous permet d'utiliser de fausses données. Cela garantit que vos tests seront rapides et ne seront pas faussés.</p> <h2 id="modules-utilisateurs-fictifs"><a href="#modules-utilisateurs-fictifs" class="header-anchor">#</a> Modules utilisateurs fictifs</h2> <p>Les simulations manuelles sont définies par l'écriture d'un module dans un sous-répertoire <code>__mocks__/</code> immédiatement adjacent au module. Par exemple, pour simuler un module appelé <code>user</code> dans le répertoire <code>models</code>, créez un fichier appelé <code>user.js</code> et placez-le dans le répertoire <code>models/__mocks</code>. Notez que le répertoire <code>__mocks__</code> est sensible à la casse, donc le fait de nommer le répertoire <code>__MOCKS__</code> va casser sur certains systèmes.</p> <blockquote><p>Lorsque nous avons besoin de ce module dans nos tests, il faut explicitement appeler <code>jest.mock('./moduleName')</code>.</p></blockquote> <h2 id="modules-de-nœuds-fictifs"><a href="#modules-de-nœuds-fictifs" class="header-anchor">#</a> Modules de nœuds fictifs</h2> <p>Si le module que vous simulez est un module Node (par exemple : <code>lodash</code>), le mock doit être placé dans le répertoire <code>__mocks__</code> adjacent à <code>node_modules</code> (sauf si vous avez configuré <a href="/jest/Guides/Configuration.html#roots-arraystring"><code>roots</code></a> pour pointer vers un dossier autre que la racine du projet) et sera <strong>automatiquement</strong> mocké. Il n'est pas nécessaire d'appeler explicitement <code>jest.mock('nom_du_module')</code>.</p> <p>Les modules scopés peuvent être simulés en créant un fichier dans une structure de répertoire qui correspond au nom du module simulé. Par exemple, pour simuler un module appelé <code>@scope/project-name</code>, créez un fichier à <code>__mocks__/@scope/project-name.js</code>, en créant le répertoire <code>@scope/</code> en conséquence.</p> <blockquote><p>Attention : Si nous voulons simuler les modules de base du Node (par exemple : <code>fs</code> ou <code>path</code>), alors l'appel explicite de <code>jest.mock('path')</code> est <strong>requis</strong>, parce que les modules de base du Node ne sont pas simulés par défaut.</p></blockquote> <h2 id="exemples"><a href="#exemples" class="header-anchor">#</a> Exemples</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
├── config
├── __mocks__
│   └── fs.js
├── models
│   ├── __mocks__
│   │   └── user.js
│   └── user.js
├── node_modules
└── views
</code></pre></div><p>Lorsqu'une simulation manuelle existe pour un module donné, le système de modules de Jest utilisera ce module en appelant explicitement <code>jest.mock('moduleName')</code>. Cependant, lorsque <code>automock</code> est défini sur <code>true</code>, l'implémentation manuelle de la fantaisie sera utilisée au lieu de la fantaisie créée automatiquement, même si <code>jest.mock('nomdumodules')</code> n'est pas appelé. Pour éviter ce comportement, vous devrez appeler explicitement <code>jest.unmock('nomdumodèle')</code> dans les tests qui doivent utiliser l'implémentation réelle du module.</p> <blockquote><p>Note : Afin de se moquer correctement, Jest a besoin que <code>jest.mock('moduleName')</code> soit dans la même portée que l'instruction <code>require/import</code>.</p></blockquote> <p>Voici un exemple d'implémentation où nous avons un module qui fournit un résumé de tous les fichiers d'un répertoire donné. Dans ce cas, nous utilisons le module de base (intégré) <code>fs</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// FileSummarizer.js</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">summarizeFilesInDirectorySync</span><span class="token punctuation">(</span><span class="token parameter">directory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    directory<span class="token punctuation">,</span>
    fileName<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>summarizeFilesInDirectorySync <span class="token operator">=</span> summarizeFilesInDirectorySync<span class="token punctuation">;</span>
</code></pre></div><p>Comme nous voulons que nos tests évitent de toucher le disques (qui est assez lent et fragile), nous créons une simulation manuelle pour le module <code>fs</code> en étendant une maquette automatique. Notre modèle manuel implémentera des versions personnalisées des API <code>fs</code> sur lesquelles nous pourrons nous appuyer pour nos tests :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// __mocks__/fs.js</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">createMockFromModule</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Il s'agit d'une fonction personnalisée que nos tests peuvent utiliser lors de la configuration pour spécifier</span>
<span class="token comment">// à quoi doivent ressembler les fichiers du système de fichiers `mock` lorsque l'uns des API `fs` est utilisée.</span>
<span class="token comment">// `fs` APIs are used.</span>
<span class="token keyword">let</span> mockFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">__setMockFiles</span><span class="token punctuation">(</span><span class="token parameter">newMockFiles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mockFiles <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">in</span> newMockFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mockFiles<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Une version personnalisée de `readdirSync` qui lit à partir de la simulation spéciale</span>
<span class="token comment">// liste de fichiers établie via __setMockFiles</span>
<span class="token keyword">function</span> <span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token parameter">directoryPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> mockFiles<span class="token punctuation">[</span>directoryPath<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

fs<span class="token punctuation">.</span>__setMockFiles <span class="token operator">=</span> __setMockFiles<span class="token punctuation">;</span>
fs<span class="token punctuation">.</span>readdirSync <span class="token operator">=</span> readdirSync<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> fs<span class="token punctuation">;</span>
</code></pre></div><p>Maintenant, que nous écrivons notre test. Notez que nous devons dire explicitement que nous voulons simuler le module <code>fs</code> parce que c'est un module de base de Node :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// __tests__/FileSummarizer-test.js</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'listFilesInDirectorySync'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">MOCK_FILE_INFO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'/path/to/file1.js'</span><span class="token operator">:</span> <span class="token string">'console.log(&quot;file1 contents&quot;);'</span><span class="token punctuation">,</span>
    <span class="token string">'/path/to/file2.txt'</span><span class="token operator">:</span> <span class="token string">'file2 contents'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Mettre en place des informations fictives sur les fichiers avant chaque test</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">__setMockFiles</span><span class="token punctuation">(</span><span class="token constant">MOCK_FILE_INFO</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'includes all files in the directory in the summary'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> FileSummarizer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../FileSummarizer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fileSummary <span class="token operator">=</span> FileSummarizer<span class="token punctuation">.</span><span class="token function">summarizeFilesInDirectorySync</span><span class="token punctuation">(</span>
      <span class="token string">'/path/to'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">expect</span><span class="token punctuation">(</span>fileSummary<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>L'exemple présenté ici utilise <a href="/jest/Guides/JestObjectAPI.html#jestcreatemockfrommodulemodulename"><code>jest.createMockFromModule</code></a> pour générer un modèle automatique, et remplace son comportement par défaut. C'est l'approche recommandée, mais elle est totalement optionnelle. Si vous ne souhaitez pas du tout utiliser la simulation automatique, vous pouvez exporter vos propres fonctions à partir du fichier de simulation. L'inconvénient des simulations entièrement manuelles est qu'elles sont manuelles, ce qui signifie que vous devez les mettre à jour manuellement chaque fois que le module dont elles sont issues change. C'est pourquoi il est préférable d'utiliser ou d'étendre la maquette automatique lorsqu'elle répond à vos besoins.</p> <p>Pour s'assurer qu'une simulation manuelle et son implémentation réelle restent synchronisées, il peut être utile d'exiger le module réel en utilisant <a href="/jest/Guides/JestObjectAPI.html#jestrequireactualmodulename"><code>jest.requireActual(moduleName)</code></a> dans votre simulation manuelle et de la modifier avec les fonctions de la simulation avant de l'exporter.</p> <p>Le code pour cet exemple est disponible sur le site <a href="https://github.com/facebook/jest/tree/master/examples/manual-mocks" target="_blank" rel="noopener noreferrer">examples/manual-mocks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="utilisation-avec-les-importations-de-modules-es"><a href="#utilisation-avec-les-importations-de-modules-es" class="header-anchor">#</a> Utilisation avec les importations de modules ES</h2> <p>Si vous utilisez <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="noopener noreferrer">ES module imports<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, vous serez normalement enclin à placer vos déclarations d'importation en haut du fichier test. Mais souvent, vous devez demander à Jest d'utiliser une simulation avant que les modules ne l'utilisent. Pour cette raison, Jest hissera automatiquement les appels <code>jest.mock</code> en haut du module (avant toute importation). Pour en savoir plus sur ce système et le voir en action, consultez <a href="https://github.com/kentcdodds/how-jest-mocking-works" target="_blank" rel="noopener noreferrer">ce repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="les-methodes-de-simulations-qui-ne-sont-pas-mises-en-œuvre-dans-jsdom"><a href="#les-methodes-de-simulations-qui-ne-sont-pas-mises-en-œuvre-dans-jsdom" class="header-anchor">#</a> Les méthodes de simulations qui ne sont pas mises en œuvre dans JSDOM</h2> <p>Si certains codes utilisent une méthode que le JSDOM (l'implémentation DOM utilisée par Jest) n'a pas encore mise en œuvre, il n'est pas facile de la tester. C'est par exemple le cas avec <code>window.matchMedia()</code>. Jest retourne <code>TypeError : window.matchMedia n'est pas une fonction</code> et n'exécute pas correctement le test.</p> <p>Dans ce cas, la simulation de <code>matchMedia</code> dans le fichier de test devrait résoudre le problème :</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'matchMedia'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token parameter">query</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    matches<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    media<span class="token operator">:</span> query<span class="token punctuation">,</span>
    onchange<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    addListener<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// déprécié</span>
    removeListener<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// déprécié</span>
    addEventListener<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    removeEventListener<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dispatchEvent<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cela fonctionne si <code>window.matchMedia()</code> est utilisé dans une fonction (ou méthode) qui est invoquée dans le test. Si <code>window.matchMedia()</code> est exécuté directement dans le fichier testé, Jest signale la même erreur. Dans ce cas, la solution est de déplacer la simulation manuelle dans un fichier séparé et d'inclure celui-ci dans le test <strong>before</strong> le fichier testé :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./matchMedia.mock'</span><span class="token punctuation">;</span> <span class="token comment">// Doit être importé avant le fichier testé</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>myMethod<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./file-to-test'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'myMethod()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Testez la méthode ici...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1dfb11b9.js" defer></script><script src="/assets/js/2.76e9c098.js" defer></script><script src="/assets/js/22.68cd31e9.js" defer></script>
  </body>
</html>
