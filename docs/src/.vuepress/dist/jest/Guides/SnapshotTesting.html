<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tests instantanés | Test in Javascript</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Testing Vuejs and JS">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f1075b4d.css" as="style"><link rel="preload" href="/assets/js/app.1dfb11b9.js" as="script"><link rel="preload" href="/assets/js/2.76e9c098.js" as="script"><link rel="preload" href="/assets/js/27.47a1acf9.js" as="script"><link rel="prefetch" href="/assets/js/10.bd6fd6a5.js"><link rel="prefetch" href="/assets/js/100.e4707484.js"><link rel="prefetch" href="/assets/js/101.e6d01fe0.js"><link rel="prefetch" href="/assets/js/102.03e4577c.js"><link rel="prefetch" href="/assets/js/103.533425bb.js"><link rel="prefetch" href="/assets/js/104.7866060c.js"><link rel="prefetch" href="/assets/js/105.c87ae376.js"><link rel="prefetch" href="/assets/js/106.1470de17.js"><link rel="prefetch" href="/assets/js/107.31d6eb75.js"><link rel="prefetch" href="/assets/js/108.8ab8ef28.js"><link rel="prefetch" href="/assets/js/109.f31541ff.js"><link rel="prefetch" href="/assets/js/11.1abf9ce7.js"><link rel="prefetch" href="/assets/js/110.7b3f1636.js"><link rel="prefetch" href="/assets/js/111.2f2eac6f.js"><link rel="prefetch" href="/assets/js/112.e118dccb.js"><link rel="prefetch" href="/assets/js/113.a8a30aa2.js"><link rel="prefetch" href="/assets/js/114.c9cd627f.js"><link rel="prefetch" href="/assets/js/115.a4796295.js"><link rel="prefetch" href="/assets/js/116.85cb9bc4.js"><link rel="prefetch" href="/assets/js/117.9857c369.js"><link rel="prefetch" href="/assets/js/118.fdd75f70.js"><link rel="prefetch" href="/assets/js/119.480af062.js"><link rel="prefetch" href="/assets/js/12.48bd50ee.js"><link rel="prefetch" href="/assets/js/120.0903be09.js"><link rel="prefetch" href="/assets/js/121.9e357b85.js"><link rel="prefetch" href="/assets/js/122.809a4b0c.js"><link rel="prefetch" href="/assets/js/123.e2038edd.js"><link rel="prefetch" href="/assets/js/124.4af8a9cc.js"><link rel="prefetch" href="/assets/js/125.b77a97ef.js"><link rel="prefetch" href="/assets/js/126.82f59f13.js"><link rel="prefetch" href="/assets/js/127.f41bdaff.js"><link rel="prefetch" href="/assets/js/128.5fca6b14.js"><link rel="prefetch" href="/assets/js/129.59147136.js"><link rel="prefetch" href="/assets/js/13.85e5e853.js"><link rel="prefetch" href="/assets/js/130.01fec4c9.js"><link rel="prefetch" href="/assets/js/131.bf32c3d1.js"><link rel="prefetch" href="/assets/js/132.5072c74e.js"><link rel="prefetch" href="/assets/js/133.e85de282.js"><link rel="prefetch" href="/assets/js/134.402e4e27.js"><link rel="prefetch" href="/assets/js/135.6dd89c1c.js"><link rel="prefetch" href="/assets/js/136.22ed1db4.js"><link rel="prefetch" href="/assets/js/137.72ab073c.js"><link rel="prefetch" href="/assets/js/138.c39958ee.js"><link rel="prefetch" href="/assets/js/139.1aa20bea.js"><link rel="prefetch" href="/assets/js/14.330cbcd9.js"><link rel="prefetch" href="/assets/js/140.c4b7b7a6.js"><link rel="prefetch" href="/assets/js/141.00a6b127.js"><link rel="prefetch" href="/assets/js/142.dc56159a.js"><link rel="prefetch" href="/assets/js/143.56bf7306.js"><link rel="prefetch" href="/assets/js/144.dc28faf5.js"><link rel="prefetch" href="/assets/js/145.58f42865.js"><link rel="prefetch" href="/assets/js/146.cdf5ac64.js"><link rel="prefetch" href="/assets/js/147.55bfcbbc.js"><link rel="prefetch" href="/assets/js/148.80f92bd1.js"><link rel="prefetch" href="/assets/js/149.d769487a.js"><link rel="prefetch" href="/assets/js/15.425a725c.js"><link rel="prefetch" href="/assets/js/150.f7925a0b.js"><link rel="prefetch" href="/assets/js/151.6218c5b9.js"><link rel="prefetch" href="/assets/js/152.41b5cfa0.js"><link rel="prefetch" href="/assets/js/153.05501cee.js"><link rel="prefetch" href="/assets/js/154.e86f3b62.js"><link rel="prefetch" href="/assets/js/155.1c63407d.js"><link rel="prefetch" href="/assets/js/156.c045d5cd.js"><link rel="prefetch" href="/assets/js/157.f6cea34d.js"><link rel="prefetch" href="/assets/js/158.7a808c51.js"><link rel="prefetch" href="/assets/js/159.b3b4561c.js"><link rel="prefetch" href="/assets/js/16.2062fdae.js"><link rel="prefetch" href="/assets/js/160.9d1f6278.js"><link rel="prefetch" href="/assets/js/161.cf4ec401.js"><link rel="prefetch" href="/assets/js/162.0047afe1.js"><link rel="prefetch" href="/assets/js/163.68d2b64d.js"><link rel="prefetch" href="/assets/js/164.ff770c4d.js"><link rel="prefetch" href="/assets/js/165.15d44e1b.js"><link rel="prefetch" href="/assets/js/166.0ffccc31.js"><link rel="prefetch" href="/assets/js/167.74e5cb83.js"><link rel="prefetch" href="/assets/js/168.3e987bc6.js"><link rel="prefetch" href="/assets/js/169.58a1c121.js"><link rel="prefetch" href="/assets/js/17.8ae89c4b.js"><link rel="prefetch" href="/assets/js/170.f5eb4958.js"><link rel="prefetch" href="/assets/js/171.de2ac02b.js"><link rel="prefetch" href="/assets/js/172.e723173f.js"><link rel="prefetch" href="/assets/js/173.ebe3373d.js"><link rel="prefetch" href="/assets/js/174.754bc705.js"><link rel="prefetch" href="/assets/js/175.68256c4c.js"><link rel="prefetch" href="/assets/js/176.0f54fcc6.js"><link rel="prefetch" href="/assets/js/177.eca24763.js"><link rel="prefetch" href="/assets/js/178.a53fc0b4.js"><link rel="prefetch" href="/assets/js/179.76c93623.js"><link rel="prefetch" href="/assets/js/18.2d051dd7.js"><link rel="prefetch" href="/assets/js/180.89a3951a.js"><link rel="prefetch" href="/assets/js/181.5545787b.js"><link rel="prefetch" href="/assets/js/182.44e30a17.js"><link rel="prefetch" href="/assets/js/183.98f27b20.js"><link rel="prefetch" href="/assets/js/184.8440af44.js"><link rel="prefetch" href="/assets/js/185.000aeddf.js"><link rel="prefetch" href="/assets/js/186.d6b8251b.js"><link rel="prefetch" href="/assets/js/187.31fa426e.js"><link rel="prefetch" href="/assets/js/188.58ccf322.js"><link rel="prefetch" href="/assets/js/189.c2ecd64b.js"><link rel="prefetch" href="/assets/js/19.7680ca75.js"><link rel="prefetch" href="/assets/js/190.6585dda4.js"><link rel="prefetch" href="/assets/js/191.ac09d6be.js"><link rel="prefetch" href="/assets/js/192.569eadde.js"><link rel="prefetch" href="/assets/js/193.dbc5d0c3.js"><link rel="prefetch" href="/assets/js/194.1ed49f10.js"><link rel="prefetch" href="/assets/js/195.73d17c86.js"><link rel="prefetch" href="/assets/js/196.38585136.js"><link rel="prefetch" href="/assets/js/197.80be5379.js"><link rel="prefetch" href="/assets/js/198.d2983630.js"><link rel="prefetch" href="/assets/js/199.c5b0eaae.js"><link rel="prefetch" href="/assets/js/20.92722f5a.js"><link rel="prefetch" href="/assets/js/200.d293a5ee.js"><link rel="prefetch" href="/assets/js/201.845153bc.js"><link rel="prefetch" href="/assets/js/202.c1a3aeac.js"><link rel="prefetch" href="/assets/js/203.fe05addc.js"><link rel="prefetch" href="/assets/js/21.be6446d5.js"><link rel="prefetch" href="/assets/js/22.68cd31e9.js"><link rel="prefetch" href="/assets/js/23.bdf61bc1.js"><link rel="prefetch" href="/assets/js/24.53cdec02.js"><link rel="prefetch" href="/assets/js/25.ebc52990.js"><link rel="prefetch" href="/assets/js/26.6c0a0e32.js"><link rel="prefetch" href="/assets/js/28.9325d706.js"><link rel="prefetch" href="/assets/js/29.5805cc76.js"><link rel="prefetch" href="/assets/js/3.55e527b8.js"><link rel="prefetch" href="/assets/js/30.c432e70c.js"><link rel="prefetch" href="/assets/js/31.3b720485.js"><link rel="prefetch" href="/assets/js/32.8badbdd6.js"><link rel="prefetch" href="/assets/js/33.748d0532.js"><link rel="prefetch" href="/assets/js/34.c3eda56a.js"><link rel="prefetch" href="/assets/js/35.71847246.js"><link rel="prefetch" href="/assets/js/36.0611c91e.js"><link rel="prefetch" href="/assets/js/37.ba71a4af.js"><link rel="prefetch" href="/assets/js/38.ac6f30d4.js"><link rel="prefetch" href="/assets/js/39.58ba7a9e.js"><link rel="prefetch" href="/assets/js/4.bf905f50.js"><link rel="prefetch" href="/assets/js/40.26590aff.js"><link rel="prefetch" href="/assets/js/41.694f8d58.js"><link rel="prefetch" href="/assets/js/42.2d7d8d44.js"><link rel="prefetch" href="/assets/js/43.9cec6759.js"><link rel="prefetch" href="/assets/js/44.f7719b56.js"><link rel="prefetch" href="/assets/js/45.939a097b.js"><link rel="prefetch" href="/assets/js/46.9eb035b4.js"><link rel="prefetch" href="/assets/js/47.717699f5.js"><link rel="prefetch" href="/assets/js/48.e2a83d9e.js"><link rel="prefetch" href="/assets/js/49.0f4a38a5.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/50.09b9cedf.js"><link rel="prefetch" href="/assets/js/51.ca236e5a.js"><link rel="prefetch" href="/assets/js/52.8ab1dd65.js"><link rel="prefetch" href="/assets/js/53.4950b2fa.js"><link rel="prefetch" href="/assets/js/54.6c28a1ae.js"><link rel="prefetch" href="/assets/js/55.203bfda1.js"><link rel="prefetch" href="/assets/js/56.feea9280.js"><link rel="prefetch" href="/assets/js/57.bbd935c4.js"><link rel="prefetch" href="/assets/js/58.98b7e31b.js"><link rel="prefetch" href="/assets/js/59.11977924.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.fef4549b.js"><link rel="prefetch" href="/assets/js/61.5cac46d9.js"><link rel="prefetch" href="/assets/js/62.96cd90d5.js"><link rel="prefetch" href="/assets/js/63.66c5a79a.js"><link rel="prefetch" href="/assets/js/64.57532410.js"><link rel="prefetch" href="/assets/js/65.d081c48d.js"><link rel="prefetch" href="/assets/js/66.cfb836a0.js"><link rel="prefetch" href="/assets/js/67.7b4dd45f.js"><link rel="prefetch" href="/assets/js/68.e7ebbee9.js"><link rel="prefetch" href="/assets/js/69.68324175.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/70.27518c57.js"><link rel="prefetch" href="/assets/js/71.7a58fc57.js"><link rel="prefetch" href="/assets/js/72.08c01f3b.js"><link rel="prefetch" href="/assets/js/73.1d2fa4b2.js"><link rel="prefetch" href="/assets/js/74.a06f107c.js"><link rel="prefetch" href="/assets/js/75.ac9e2bd1.js"><link rel="prefetch" href="/assets/js/76.899208f6.js"><link rel="prefetch" href="/assets/js/77.0f1d0c65.js"><link rel="prefetch" href="/assets/js/78.8a73a4c3.js"><link rel="prefetch" href="/assets/js/79.e2db69cb.js"><link rel="prefetch" href="/assets/js/8.d194c183.js"><link rel="prefetch" href="/assets/js/80.b61d7063.js"><link rel="prefetch" href="/assets/js/81.a82b5e62.js"><link rel="prefetch" href="/assets/js/82.9a5b8058.js"><link rel="prefetch" href="/assets/js/83.10352c38.js"><link rel="prefetch" href="/assets/js/84.ccacae49.js"><link rel="prefetch" href="/assets/js/85.ee9987ed.js"><link rel="prefetch" href="/assets/js/86.f89fad1c.js"><link rel="prefetch" href="/assets/js/87.44e47fe2.js"><link rel="prefetch" href="/assets/js/88.94dfbf30.js"><link rel="prefetch" href="/assets/js/89.04227930.js"><link rel="prefetch" href="/assets/js/9.2250d602.js"><link rel="prefetch" href="/assets/js/90.7a82ea28.js"><link rel="prefetch" href="/assets/js/91.4a625cbe.js"><link rel="prefetch" href="/assets/js/92.29d2fcc3.js"><link rel="prefetch" href="/assets/js/93.3223892e.js"><link rel="prefetch" href="/assets/js/94.7584ac0d.js"><link rel="prefetch" href="/assets/js/95.75db5c06.js"><link rel="prefetch" href="/assets/js/96.bf62c5a6.js"><link rel="prefetch" href="/assets/js/97.66fdd036.js"><link rel="prefetch" href="/assets/js/98.c9d329be.js"><link rel="prefetch" href="/assets/js/99.b6f9c026.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1075b4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Test in Javascript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest/" aria-current="page" class="sidebar-link">Jest</a></li><li><a href="/jest/introduction.html" class="sidebar-link">Pour commencer</a></li><li><a href="/jest/guides.html" class="sidebar-link">Tests instantanés</a></li><li><a href="/jest/framework.html" class="sidebar-link">Tester les Apps React</a></li><li><a href="/jest/api.html" class="sidebar-link">Les api générales</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tests-instantanes"><a href="#tests-instantanes" class="header-anchor">#</a> Tests instantanés</h1> <p>Les tests instantanés sont un outil très utile lorsque vous voulez vous assurer que votre UI ne change pas de manière inattendue.</p> <p>Un scénario de test snapshot typique rend un composant de l'interface utilisateur, prend un instantané, puis le compare à un fichier snapshot de référence stocké à côté du test. Le test échouera si les deux instantanés ne correspondent pas : soit le changement est inattendu, soit l'instantané de référence doit être mis à jour avec la nouvelle version du composant de l'interface utilisateur.</p> <h2 id="test-instantane-avec-jest"><a href="#test-instantane-avec-jest" class="header-anchor">#</a> Test instantané avec Jest</h2> <p>Une approche similaire peut être adoptée lorsqu'il s'agit de tester vos composants React. Au lieu de rendre l'interface graphique, ce qui nécessiterait de construire l'application entière, vous pouvez utiliser un moteur de rendu de test pour générer rapidement une valeur sérialisable pour votre arbre React. Considérez ce <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/link.react.test.js" target="_blank" rel="noopener noreferrer">exemple de test<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour un <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Link.react.js" target="_blank" rel="noopener noreferrer">composant de lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'../Link.react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> renderer <span class="token keyword">from</span> <span class="token string">'react-test-renderer'</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.facebook.com&quot;</span><span class="token operator">&gt;</span>Facebook<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>La première fois que ce test est effectué, Jest crée un [fichier instantané] (https://github.com/facebook/jest/blob/master/examples/snapshot/<strong>tests</strong>/<strong>snapshots</strong>/link.react.test.js.snap) qui ressemble à ceci :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renders correctly 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;a
  className=&quot;normal&quot;
  href=&quot;http://www.facebook.com&quot;
  onMouseEnter={[Function]}
  onMouseLeave={[Function]}
&gt;
  Facebook
&lt;/a&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>L'artefact instantané doit être commis en même temps que les changements de code, et examiné dans le cadre de votre processus de révision du code. Jest utilise [pretty-format] (https://github.com/facebook/jest/tree/master/packages/pretty-format) pour rendre les instantanés lisibles par l'homme pendant la révision du code. Lors des tests suivants, Jest compare la sortie rendue avec l'instantané précédent. S'ils correspondent, le test sera réussi. S'ils ne correspondent pas, soit le testeur a trouvé un bug dans votre code (dans ce cas, c'est le composant <code>&lt;Link&gt;</code>) qui doit être corrigé, soit l'implémentation a changé et l'instantané doit être mis à jour.</p> <blockquote><p>Note : L'instantané est directement lié aux données que vous rendez - dans notre exemple, il s'agit du composant <code>&lt;Link /&gt;</code> avec le page prop qui lui est passé. Cela implique que même si un autre fichier a des accessoires manquants (disons, <code>App.js</code>) dans le composant <code>&lt;Link /&gt;</code>, il passera quand même le test car le test ne connaît pas l'utilisation du composant <code>&lt;Link /&gt;</code> et il est seulement limité au composant <code>Link.react.js</code>. De plus, rendre le même composant avec des accessoires différents dans d'autres tests d'instantanés n'affectera pas le premier, car les tests ne se connaissent pas entre eux.</p></blockquote> <p>Vous trouverez plus d'informations sur le fonctionnement des tests instantanés et sur la raison pour laquelle nous les avons mis en place sur le [release blog post] (https://jestjs.io/blog/2016/07/27/jest-14.html). Nous vous recommandons de lire [ce billet] (http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/) pour avoir une bonne idée du moment où vous devriez utiliser les tests d'instantanés. Nous vous recommandons également de regarder cette [vidéo egghead] (https://egghead.io/lessons/javascript-use-jest-s-snapshot-testing-feature?pl=testing-javascript-with-jest-a36c4074) sur le test instantané avec Jest.</p> <h3 id="mise-a-jour-des-instantanes"><a href="#mise-a-jour-des-instantanes" class="header-anchor">#</a> Mise à jour des instantanés</h3> <p>Il est facile de repérer quand un test instantané échoue après l'introduction d'un bug. Lorsque cela se produit, corrigez le problème et assurez-vous que vos tests instantanés sont à nouveau réussis. Maintenant, parlons du cas où un test instantané échoue à cause d'un changement intentionnel de l'implémentation.</p> <p>Une telle situation peut se produire si nous modifions intentionnellement l'adresse vers laquelle le composant Link de notre exemple pointe.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Cas test mis à jour avec un lien vers une adresse différente</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.instagram.com&quot;</span><span class="token operator">&gt;</span>Instagram<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Dans ce cas, Jest imprimera cette sortie :</p> <p><img src="/img/content/failedSnapshotTest.png" alt=""></p> <p>Comme nous venons de mettre à jour notre composant pour qu'il pointe vers une adresse différente, il est raisonnable de s'attendre à des changements dans l'instantané de ce composant. Notre scénario de test de l'instantané échoue parce que l'instantané de notre composant mis à jour ne correspond plus à l'artefact de l'instantané de ce scénario de test.</p> <p>Pour résoudre ce problème, nous devrons mettre à jour nos artefacts d'instantané. Vous pouvez lancer Jest avec un drapeau qui lui indiquera de générer à nouveau des instantanés :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>jest --updateSnapshot
</code></pre></div><p>Allez-y et acceptez les changements en exécutant la commande ci-dessus. Vous pouvez également utiliser l'équivalent du drapeau <code>-u</code> à un seul caractère pour générer à nouveau des instantanés si vous préférez. Cela permettra de générer à nouveau des artefacts d'instantanés pour tous les tests d'instantanés qui échouent. Si nous avions d'autres échecs de tests d'instantanés à cause d'un bug involontaire, nous aurions besoin de corriger le bug avant de re-générer des instantanés pour éviter d'enregistrer des instantanés du comportement bogué.</p> <p>Si vous souhaitez limiter les cas de tests snapshot à re-générer, vous pouvez passer un drapeau supplémentaire <code>--testNamePattern</code> pour ne ré-enregistrer des snapshots que pour les tests qui correspondent au pattern.</p> <p>Vous pouvez tester cette fonctionnalité en clonant le [snapshot example] (https://github.com/facebook/jest/tree/master/examples/snapshot), en modifiant le composant &quot;Link&quot; et en lançant Jest.</p> <h3 id="mode-instantane-interactif"><a href="#mode-instantane-interactif" class="header-anchor">#</a> Mode instantané interactif</h3> <p>Les clichés ratés peuvent également être mis à jour de manière interactive en mode veille :</p> <p><img src="/img/content/interactiveSnapshot.png" alt=""></p> <p>Une fois que vous entrez dans le mode instantané interactif, Jest vous fera passer les instantanés ratés un test à la fois et vous donnera la possibilité de revoir les résultats ratés.</p> <p>De là, vous pouvez choisir de mettre à jour cet instantané ou de passer au suivant :</p> <p><img src="/img/content/interactiveSnapshotUpdate.gif" alt=""></p> <p>Une fois que vous aurez terminé, Jest vous donnera un résumé avant de revenir au mode de surveillance :</p> <p><img src="/img/content/interactiveSnapshotDone.png" alt=""></p> <h3 id="instantanes-en-ligne"><a href="#instantanes-en-ligne" class="header-anchor">#</a> Instantanés en ligne</h3> <p>Les instantanés en ligne se comportent de manière identique aux instantanés externes (fichiers &quot;snap&quot;), sauf que les valeurs des instantanés sont automatiquement réécrites dans le code source. Cela signifie que vous pouvez bénéficier des avantages des instantanés générés automatiquement sans avoir à passer à un fichier externe pour vous assurer que la bonne valeur a été écrite.</p> <blockquote><p>Les photos en ligne sont alimentées par [Prettier] (https://prettier.io). Pour utiliser les instantanés en ligne, vous devez avoir installé <code>prettier</code> dans votre projet. Votre configuration Prettier sera respectée lors de l'écriture des fichiers de test.</p> <p>Si vous avez installé <code>prettier</code> dans un endroit où Jest ne peut pas le trouver, vous pouvez lui dire comment le trouver en utilisant la propriété de configuration <a href="/jest/Guides/Configuration.html#prettierpath-string"><code>&quot;prettierPath&quot;</code></a>.</p></blockquote> <p><strong>Exemple :</strong></p> <p>D'abord, vous écrirez un test, en appelant <code>.toMatchInlineSnapshot()</code> sans arguments :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;https://prettier.io&quot;</span><span class="token operator">&gt;</span>Prettier<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>La prochaine fois que vous lancerez Jest, <code>tree</code> sera évalué, et un snapshot sera écrit en argument de <code>toMatchInlineSnapshot</code> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;https://prettier.io&quot;</span><span class="token operator">&gt;</span>Prettier<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;a
  className=&quot;normal&quot;
  href=&quot;https://prettier.io&quot;
  onMouseEnter={[Function]}
  onMouseLeave={[Function]}
&gt;
  Prettier
&lt;/a&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>C'est tout ce qu'il y a à faire ! Vous pouvez même mettre à jour les snapshots avec <code>--updateSnapshot</code> ou en utilisant la touche <code>u</code> en mode <code>--watch</code>.</p> <h3 id="les-matchers-de-propriete"><a href="#les-matchers-de-propriete" class="header-anchor">#</a> Les matchers de propriété</h3> <p>Souvent, l'objet que vous souhaitez photographier comporte des champs qui sont générés (comme les ID et les dates). Si vous essayez de prendre un instantané de ces objets, ils forceront l'instantané à échouer à chaque exécution :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will fail every time'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'LeBron James'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will fail every time 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: 2018-05-19T23:36:09.816Z,
  &quot;id&quot;: 3,
  &quot;name&quot;: &quot;LeBron James&quot;,
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Pour ces cas, Jest permet de fournir un appariement asymétrique pour n'importe quel bien. Ces correspondances sont vérifiées avant que l'instantané ne soit écrit ou testé, puis enregistrées dans le fichier de l'instantané au lieu de la valeur reçue :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will check the matchers and pass'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'LeBron James'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will check the matchers and pass 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: Any&lt;Date&gt;,
  &quot;id&quot;: Any&lt;Number&gt;,
  &quot;name&quot;: &quot;LeBron James&quot;,
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Toute valeur donnée qui n'est pas une correspondance sera vérifiée exactement et enregistrée dans l'instantané :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will check the values and pass'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Bond... James Bond'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Bond... James Bond'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will check the values and pass 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: Any&lt;Date&gt;,
  &quot;name&quot;: 'Bond... James Bond',
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h2 id="meilleures-pratiques"><a href="#meilleures-pratiques" class="header-anchor">#</a> Meilleures pratiques</h2> <p>Les instantanés sont un outil fantastique pour identifier les changements d'interface inattendus au sein de votre application - que cette interface soit une réponse API, une interface utilisateur, des journaux ou des messages d'erreur. Comme pour toute stratégie de test, il existe des bonnes pratiques que vous devez connaître et des directives que vous devez suivre pour les utiliser efficacement.</p> <h3 id="_1-traiter-les-instantanes-comme-du-code"><a href="#_1-traiter-les-instantanes-comme-du-code" class="header-anchor">#</a> 1. Traiter les instantanés comme du code</h3> <p>Faites des instantanés et examinez-les dans le cadre de votre processus régulier de révision du code. Cela signifie que vous devez traiter les instantanés comme n'importe quel autre type de test ou de code dans votre projet.</p> <p>Assurez-vous que vos instantanés sont lisibles en les gardant concentrés, courts, et en utilisant des outils qui font respecter ces conventions stylistiques.</p> <p>Comme mentionné précédemment, Jest utilise <a href="https://yarnpkg.com/en/package/pretty-format" target="_blank" rel="noopener noreferrer"><code>pretty-format</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour rendre les instantanés lisibles par l'homme, mais vous pouvez trouver utile d'introduire des outils supplémentaires, comme <a href="https://yarnpkg.com/en/package/eslint-plugin-jest" target="_blank" rel="noopener noreferrer"><code>eslint-plugin-jest</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> avec son option <a href="https://github.com/jest-community/eslint-plugin-jest/blob/master/docs/rules/no-large-snapshots.md" target="_blank" rel="noopener noreferrer"><code>no-large-snapshots</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, ou <a href="https://yarnpkg.com/en/package/snapshot-diff" target="_blank" rel="noopener noreferrer"><code>snapshot-diff</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> avec sa fonction de comparaison d'instantanés de composants, afin de promouvoir des affirmations courtes et ciblées.</p> <p>L'objectif est de faciliter l'examen des instantanés dans les requêtes pull, et de lutter contre l'habitude de régénérer les instantanés lorsque les suites de test échouent au lieu d'examiner les causes profondes de leur échec.</p> <h3 id="_2-les-tests-doivent-etre-deterministes"><a href="#_2-les-tests-doivent-etre-deterministes" class="header-anchor">#</a> 2. Les tests doivent être déterministes</h3> <p>Vos tests doivent être déterministes. Exécuter les mêmes tests plusieurs fois sur un composant qui n'a pas changé devrait produire les mêmes résultats à chaque fois. Vous devez vous assurer que les instantanés générés ne contiennent pas de données spécifiques à la plate-forme ou d'autres données non déterministes.</p> <p>Par exemple, si vous avez un composant <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Clock.react.js" target="_blank" rel="noopener noreferrer">Clock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> qui utilise <code>Date.now()</code>, l'instantané généré par ce composant sera différent à chaque fois que le scénario de test sera exécuté. Dans ce cas, nous pouvons <a href="/jest/Guides/MockFunctions.html">simuler la méthode Date.now()</a> pour renvoyer une valeur cohérente à chaque fois que le test est exécuté :</p> <div class="language-js extra-class"><pre class="language-js"><code>Date<span class="token punctuation">.</span>now <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1482363367071</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Maintenant, à chaque fois que le scénario de test de l'instantané est exécuté, <code>Date.now()</code> renverra <code>1482363367071</code> de manière cohérente. Cela aura pour conséquence de générer le même instantané pour ce composant, quel que soit le moment où le test est exécuté.</p> <h3 id="_3-utiliser-des-noms-d-instantanes-descriptifs"><a href="#_3-utiliser-des-noms-d-instantanes-descriptifs" class="header-anchor">#</a> 3. Utiliser des noms d'instantanés descriptifs</h3> <p>Essayez toujours d'utiliser des noms de tests descriptifs et/ou de clichés pour les instantanés. Les meilleurs noms décrivent le contenu attendu de l'instantané. Il est ainsi plus facile pour les examinateurs de vérifier les instantanés pendant l'examen, et pour quiconque de savoir si un instantané périmé est ou non le bon comportement avant la mise à jour.</p> <p>Par exemple, comparer :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should handle some test case</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should handle some other test case</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>A L'adresse suivante :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render Alan Turing</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Comme ce dernier décrit exactement ce qui est attendu dans le résultat, il est plus clair de voir quand il est erroné :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render Alan Turing</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h2 id="foire-aux-questions"><a href="#foire-aux-questions" class="header-anchor">#</a> Foire aux questions</h2> <h3 id="les-instantanes-sont-ils-ecrits-automatiquement-sur-les-systemes-d-integration-continue-ic"><a href="#les-instantanes-sont-ils-ecrits-automatiquement-sur-les-systemes-d-integration-continue-ic" class="header-anchor">#</a> Les instantanés sont-ils écrits automatiquement sur les systèmes d'intégration continue (IC) ?</h3> <p>Non, à partir de Jest 20, les snapshots dans Jest ne sont pas automatiquement écrits lorsque Jest est exécuté dans un système de CI sans passer explicitement par <code>--updateSnapshot</code>. On s'attend à ce que tous les snapshots fassent partie du code qui est exécuté sur le CI et comme les nouveaux snapshots passent automatiquement, ils ne devraient pas passer un test sur un système de CI. Il est recommandé de toujours valider tous les instantanés et de les garder sous contrôle de version.</p> <h3 id="faut-il-commettre-des-instantanes"><a href="#faut-il-commettre-des-instantanes" class="header-anchor">#</a> Faut-il commettre des instantanés ?</h3> <p>Oui, tous les fichiers d'instantanés doivent être validés en même temps que les modules qu'ils couvrent et leurs tests. Ils doivent être considérés comme faisant partie d'un test, tout comme la valeur de toute autre affirmation dans Jest. En fait, les instantanés représentent l'état des modules sources à un moment donné. De cette façon, lorsque les modules sources sont modifiés, Jest peut dire ce qui a changé par rapport à la version précédente. Il peut également fournir beaucoup de contexte supplémentaire pendant la révision du code, dans lequel les réviseurs peuvent mieux étudier vos changements.</p> <h3 id="est-ce-que-les-tests-instantanes-ne-fonctionnent-qu-avec-les-composants-react"><a href="#est-ce-que-les-tests-instantanes-ne-fonctionnent-qu-avec-les-composants-react" class="header-anchor">#</a> Est-ce que les tests instantanés ne fonctionnent qu'avec les composants React ?</h3> <p>Les composants <a href="/jest/Guides/TutorialReact.html">React</a> et <a href="/jest/Guides/TutorialReactNative.html">React Native</a> sont un bon cas d'utilisation pour les tests d'instantanés. Cependant, les instantanés peuvent capturer n'importe quelle valeur sérialisable et doivent être utilisés chaque fois que l'objectif est de tester si la sortie est correcte. Le dépôt Jest contient de nombreux exemples de test de la sortie de Jest lui-même, de la sortie de la bibliothèque d'assertions de Jest ainsi que des messages de log de diverses parties de la base de code de Jest. Voir un exemple de <a href="https://github.com/facebook/jest/blob/master/e2e/__tests__/console.test.ts" target="_blank" rel="noopener noreferrer">snapshotting CLI output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> dans le dépôt Jest.</p> <h3 id="quelle-est-la-difference-entre-un-test-d-instantane-et-un-test-de-regression-visuelle"><a href="#quelle-est-la-difference-entre-un-test-d-instantane-et-un-test-de-regression-visuelle" class="header-anchor">#</a> Quelle est la différence entre un test d'instantané et un test de régression visuelle ?</h3> <p>Les tests instantanés et les tests de régression visuelle sont deux moyens distincts de tester les interfaces utilisateur, et ils servent des objectifs différents. Les outils de test de régression visuelle prennent des captures d'écran de pages web et comparent les images résultantes pixel par pixel. Avec le test Snapshot, les valeurs sont sérialisées, stockées dans des fichiers texte et comparées à l'aide d'un algorithme de diffraction. Il y a différents compromis à considérer et nous avons énuméré les raisons pour lesquelles les tests instantanés ont été construits dans le [Jest blog] (https://jestjs.io/blog/2016/07/27/jest-14.html#why-snapshot-testing).</p> <h3 id="les-tests-instantanes-remplacent-ils-les-tests-unitaires"><a href="#les-tests-instantanes-remplacent-ils-les-tests-unitaires" class="header-anchor">#</a> Les tests instantanés remplacent-ils les tests unitaires ?</h3> <p>Le test instantané n'est qu'une des 20 affirmations qui accompagnent Jest. L'objectif des tests instantanés n'est pas de remplacer les tests unitaires existants, mais d'apporter une valeur ajoutée et de rendre les tests indolores. Dans certains scénarios, les tests instantanés peuvent potentiellement supprimer la nécessité de tests unitaires pour un ensemble particulier de fonctionnalités (par exemple, les composants de réaction), mais ils peuvent également fonctionner ensemble.</p> <h3 id="quelles-sont-les-performances-des-tests-d-instantanes-en-ce-qui-concerne-la-vitesse-et-la-taille-des-fichiers-generes"><a href="#quelles-sont-les-performances-des-tests-d-instantanes-en-ce-qui-concerne-la-vitesse-et-la-taille-des-fichiers-generes" class="header-anchor">#</a> Quelles sont les performances des tests d'instantanés en ce qui concerne la vitesse et la taille des fichiers générés ?</h3> <p>Jest a été réécrit dans un souci de performance, et les tests d'instantanés ne font pas exception. Comme les instantanés sont stockés dans des fichiers texte, cette méthode de test est rapide et fiable. Jest génère un nouveau fichier pour chaque fichier de test qui invoque le &quot;MatchSnapshot&quot;. La taille des snapshots est assez petite : Pour référence, la taille de tous les fichiers d'instantanés dans la base de code de Jest elle-même est inférieure à 300 Ko.</p> <h3 id="comment-resoudre-les-conflits-dans-les-fichiers-d-instantanes"><a href="#comment-resoudre-les-conflits-dans-les-fichiers-d-instantanes" class="header-anchor">#</a> Comment résoudre les conflits dans les fichiers d'instantanés ?</h3> <p>Les fichiers d'instantanés doivent toujours représenter l'état actuel des modules qu'ils couvrent. Par conséquent, si vous fusionnez deux branches et que vous rencontrez un conflit dans les fichiers d'instantanés, vous pouvez soit résoudre le conflit manuellement, soit mettre à jour le fichier d'instantanés en exécutant Jest et en inspectant le résultat.</p> <h3 id="est-il-possible-d-appliquer-les-principes-de-developpement-pilote-par-les-tests-avec-des-tests-instantanes"><a href="#est-il-possible-d-appliquer-les-principes-de-developpement-pilote-par-les-tests-avec-des-tests-instantanes" class="header-anchor">#</a> Est-il possible d'appliquer les principes de développement piloté par les tests avec des tests instantanés ?</h3> <p>Bien qu'il soit possible d'écrire des fichiers d'instantanés manuellement, cela n'est généralement pas envisageable. Les instantanés aident à déterminer si la sortie des modules couverts par les tests est modifiée, plutôt que de donner des conseils pour concevoir le code en premier lieu.</p> <h3 id="la-couverture-de-code-fonctionne-t-elle-avec-les-tests-instantanes"><a href="#la-couverture-de-code-fonctionne-t-elle-avec-les-tests-instantanes" class="header-anchor">#</a> La couverture de code fonctionne-t-elle avec les tests instantanés ?</h3> <p>Oui, ainsi qu'avec tout autre test.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1dfb11b9.js" defer></script><script src="/assets/js/2.76e9c098.js" defer></script><script src="/assets/js/27.47a1acf9.js" defer></script>
  </body>
</html>
