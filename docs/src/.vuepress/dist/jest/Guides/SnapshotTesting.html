<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tests instantanÃ©s | Test in Javascript</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Testing Vuejs and JS">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.ea2dea0c.css" as="style"><link rel="preload" href="/assets/js/app.24bc32f1.js" as="script"><link rel="preload" href="/assets/js/2.76e9c098.js" as="script"><link rel="preload" href="/assets/js/27.61521ef6.js" as="script"><link rel="prefetch" href="/assets/js/10.bd6fd6a5.js"><link rel="prefetch" href="/assets/js/100.8b2af6ca.js"><link rel="prefetch" href="/assets/js/101.07acf063.js"><link rel="prefetch" href="/assets/js/102.1929f46a.js"><link rel="prefetch" href="/assets/js/103.901cb352.js"><link rel="prefetch" href="/assets/js/104.08c08b1b.js"><link rel="prefetch" href="/assets/js/105.c87ae376.js"><link rel="prefetch" href="/assets/js/106.b9540579.js"><link rel="prefetch" href="/assets/js/107.c373e56a.js"><link rel="prefetch" href="/assets/js/108.190a5b42.js"><link rel="prefetch" href="/assets/js/109.de77279a.js"><link rel="prefetch" href="/assets/js/11.1abf9ce7.js"><link rel="prefetch" href="/assets/js/110.59279552.js"><link rel="prefetch" href="/assets/js/111.339076a2.js"><link rel="prefetch" href="/assets/js/112.e118dccb.js"><link rel="prefetch" href="/assets/js/113.5c0bd789.js"><link rel="prefetch" href="/assets/js/114.1d668748.js"><link rel="prefetch" href="/assets/js/115.fe28a47f.js"><link rel="prefetch" href="/assets/js/116.85cb9bc4.js"><link rel="prefetch" href="/assets/js/117.5d84ecae.js"><link rel="prefetch" href="/assets/js/118.97071e86.js"><link rel="prefetch" href="/assets/js/119.b1619621.js"><link rel="prefetch" href="/assets/js/12.9cda47c9.js"><link rel="prefetch" href="/assets/js/120.567ed6d6.js"><link rel="prefetch" href="/assets/js/121.45f71502.js"><link rel="prefetch" href="/assets/js/122.4bc1494e.js"><link rel="prefetch" href="/assets/js/123.1fe4d3cd.js"><link rel="prefetch" href="/assets/js/124.813789b6.js"><link rel="prefetch" href="/assets/js/125.0b07623a.js"><link rel="prefetch" href="/assets/js/126.edac2a7b.js"><link rel="prefetch" href="/assets/js/127.98f2f204.js"><link rel="prefetch" href="/assets/js/128.b37a7ef5.js"><link rel="prefetch" href="/assets/js/129.c343c3cb.js"><link rel="prefetch" href="/assets/js/13.85e5e853.js"><link rel="prefetch" href="/assets/js/130.c28fd2d7.js"><link rel="prefetch" href="/assets/js/131.e3da3de8.js"><link rel="prefetch" href="/assets/js/132.1262f0f9.js"><link rel="prefetch" href="/assets/js/133.e4c7b81d.js"><link rel="prefetch" href="/assets/js/134.4f10e5ad.js"><link rel="prefetch" href="/assets/js/135.6d73ee1c.js"><link rel="prefetch" href="/assets/js/136.5704a081.js"><link rel="prefetch" href="/assets/js/137.48982e54.js"><link rel="prefetch" href="/assets/js/138.9467f55e.js"><link rel="prefetch" href="/assets/js/139.ae166ff8.js"><link rel="prefetch" href="/assets/js/14.b9453e71.js"><link rel="prefetch" href="/assets/js/140.fdb98c05.js"><link rel="prefetch" href="/assets/js/141.2a2afcd3.js"><link rel="prefetch" href="/assets/js/142.ad3c4a11.js"><link rel="prefetch" href="/assets/js/143.dacf248f.js"><link rel="prefetch" href="/assets/js/144.33749fca.js"><link rel="prefetch" href="/assets/js/145.95a7d271.js"><link rel="prefetch" href="/assets/js/146.851f988c.js"><link rel="prefetch" href="/assets/js/147.7b397c38.js"><link rel="prefetch" href="/assets/js/148.bfa13c36.js"><link rel="prefetch" href="/assets/js/149.d769487a.js"><link rel="prefetch" href="/assets/js/15.a8754c4f.js"><link rel="prefetch" href="/assets/js/150.f7925a0b.js"><link rel="prefetch" href="/assets/js/151.30fc2417.js"><link rel="prefetch" href="/assets/js/152.da862d56.js"><link rel="prefetch" href="/assets/js/153.05501cee.js"><link rel="prefetch" href="/assets/js/154.13688f7b.js"><link rel="prefetch" href="/assets/js/155.5595f5b5.js"><link rel="prefetch" href="/assets/js/156.4607c511.js"><link rel="prefetch" href="/assets/js/157.8f3520e6.js"><link rel="prefetch" href="/assets/js/158.ed6318c6.js"><link rel="prefetch" href="/assets/js/159.ac08b4df.js"><link rel="prefetch" href="/assets/js/16.95db1a40.js"><link rel="prefetch" href="/assets/js/160.81eedd9c.js"><link rel="prefetch" href="/assets/js/161.d1ecd9fa.js"><link rel="prefetch" href="/assets/js/162.5bc472e3.js"><link rel="prefetch" href="/assets/js/163.5338ad76.js"><link rel="prefetch" href="/assets/js/164.00159e33.js"><link rel="prefetch" href="/assets/js/165.fd12f649.js"><link rel="prefetch" href="/assets/js/166.f5fd8ca2.js"><link rel="prefetch" href="/assets/js/167.0edc1d53.js"><link rel="prefetch" href="/assets/js/168.58447d54.js"><link rel="prefetch" href="/assets/js/169.218ee891.js"><link rel="prefetch" href="/assets/js/17.755e0cd0.js"><link rel="prefetch" href="/assets/js/170.199c205f.js"><link rel="prefetch" href="/assets/js/171.43f89ffb.js"><link rel="prefetch" href="/assets/js/172.5f627aeb.js"><link rel="prefetch" href="/assets/js/173.226d046a.js"><link rel="prefetch" href="/assets/js/174.3b7c1fe6.js"><link rel="prefetch" href="/assets/js/175.7ed848e5.js"><link rel="prefetch" href="/assets/js/176.ed19d38d.js"><link rel="prefetch" href="/assets/js/177.d2e99cd6.js"><link rel="prefetch" href="/assets/js/178.d83769b6.js"><link rel="prefetch" href="/assets/js/179.61302ec9.js"><link rel="prefetch" href="/assets/js/18.b3b0e0e4.js"><link rel="prefetch" href="/assets/js/180.54ae0f5f.js"><link rel="prefetch" href="/assets/js/181.cba0e05c.js"><link rel="prefetch" href="/assets/js/182.ecbbf334.js"><link rel="prefetch" href="/assets/js/183.c3a4205b.js"><link rel="prefetch" href="/assets/js/184.19fdcb7a.js"><link rel="prefetch" href="/assets/js/185.46ebc6f2.js"><link rel="prefetch" href="/assets/js/186.d1e72cee.js"><link rel="prefetch" href="/assets/js/187.87231894.js"><link rel="prefetch" href="/assets/js/188.f0b6fc01.js"><link rel="prefetch" href="/assets/js/189.eb432878.js"><link rel="prefetch" href="/assets/js/19.aabe0e7d.js"><link rel="prefetch" href="/assets/js/190.14b00b81.js"><link rel="prefetch" href="/assets/js/191.3f909bfd.js"><link rel="prefetch" href="/assets/js/192.028860bf.js"><link rel="prefetch" href="/assets/js/193.1b5b2f37.js"><link rel="prefetch" href="/assets/js/194.8d323eea.js"><link rel="prefetch" href="/assets/js/195.f0e12767.js"><link rel="prefetch" href="/assets/js/196.a2d7cf41.js"><link rel="prefetch" href="/assets/js/197.968f03ff.js"><link rel="prefetch" href="/assets/js/198.ef355cb1.js"><link rel="prefetch" href="/assets/js/199.515dd329.js"><link rel="prefetch" href="/assets/js/20.1e7f3f8e.js"><link rel="prefetch" href="/assets/js/200.9a6dac1b.js"><link rel="prefetch" href="/assets/js/201.41cd0115.js"><link rel="prefetch" href="/assets/js/202.ae766aff.js"><link rel="prefetch" href="/assets/js/21.bb911945.js"><link rel="prefetch" href="/assets/js/22.addf865a.js"><link rel="prefetch" href="/assets/js/23.28243e94.js"><link rel="prefetch" href="/assets/js/24.a17de2c4.js"><link rel="prefetch" href="/assets/js/25.02bfc0b8.js"><link rel="prefetch" href="/assets/js/26.cbf75245.js"><link rel="prefetch" href="/assets/js/28.9325d706.js"><link rel="prefetch" href="/assets/js/29.5805cc76.js"><link rel="prefetch" href="/assets/js/3.7c32fca4.js"><link rel="prefetch" href="/assets/js/30.3bac8758.js"><link rel="prefetch" href="/assets/js/31.d7527875.js"><link rel="prefetch" href="/assets/js/32.c93dd641.js"><link rel="prefetch" href="/assets/js/33.748d0532.js"><link rel="prefetch" href="/assets/js/34.20de348f.js"><link rel="prefetch" href="/assets/js/35.23193db6.js"><link rel="prefetch" href="/assets/js/36.0611c91e.js"><link rel="prefetch" href="/assets/js/37.f7324ef3.js"><link rel="prefetch" href="/assets/js/38.a69f5e3e.js"><link rel="prefetch" href="/assets/js/39.f45216ca.js"><link rel="prefetch" href="/assets/js/4.983f137d.js"><link rel="prefetch" href="/assets/js/40.c6afcce6.js"><link rel="prefetch" href="/assets/js/41.6c902063.js"><link rel="prefetch" href="/assets/js/42.d8e63344.js"><link rel="prefetch" href="/assets/js/43.9cec6759.js"><link rel="prefetch" href="/assets/js/44.5200d14e.js"><link rel="prefetch" href="/assets/js/45.b2a69d52.js"><link rel="prefetch" href="/assets/js/46.c818f64c.js"><link rel="prefetch" href="/assets/js/47.56ff6553.js"><link rel="prefetch" href="/assets/js/48.e2a83d9e.js"><link rel="prefetch" href="/assets/js/49.a4b7c360.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/50.62818f18.js"><link rel="prefetch" href="/assets/js/51.adc8dadf.js"><link rel="prefetch" href="/assets/js/52.8ab1dd65.js"><link rel="prefetch" href="/assets/js/53.4950b2fa.js"><link rel="prefetch" href="/assets/js/54.10d7d06f.js"><link rel="prefetch" href="/assets/js/55.92fb6735.js"><link rel="prefetch" href="/assets/js/56.1ed516ad.js"><link rel="prefetch" href="/assets/js/57.7d01fe08.js"><link rel="prefetch" href="/assets/js/58.c5c2b239.js"><link rel="prefetch" href="/assets/js/59.24cf9a09.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.e955341b.js"><link rel="prefetch" href="/assets/js/61.5cac46d9.js"><link rel="prefetch" href="/assets/js/62.13cba836.js"><link rel="prefetch" href="/assets/js/63.779e4489.js"><link rel="prefetch" href="/assets/js/64.8772eb9a.js"><link rel="prefetch" href="/assets/js/65.c36159d8.js"><link rel="prefetch" href="/assets/js/66.1c1067aa.js"><link rel="prefetch" href="/assets/js/67.c8fcf10f.js"><link rel="prefetch" href="/assets/js/68.68cd681c.js"><link rel="prefetch" href="/assets/js/69.c11cf74a.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/70.cd1c6d9c.js"><link rel="prefetch" href="/assets/js/71.7a58fc57.js"><link rel="prefetch" href="/assets/js/72.d4818f32.js"><link rel="prefetch" href="/assets/js/73.1d2fa4b2.js"><link rel="prefetch" href="/assets/js/74.c78932fc.js"><link rel="prefetch" href="/assets/js/75.d4d78c9d.js"><link rel="prefetch" href="/assets/js/76.899208f6.js"><link rel="prefetch" href="/assets/js/77.d7a98769.js"><link rel="prefetch" href="/assets/js/78.f38bbb92.js"><link rel="prefetch" href="/assets/js/79.21960021.js"><link rel="prefetch" href="/assets/js/8.aef0e204.js"><link rel="prefetch" href="/assets/js/80.98ce429f.js"><link rel="prefetch" href="/assets/js/81.9bea15a0.js"><link rel="prefetch" href="/assets/js/82.cf27c952.js"><link rel="prefetch" href="/assets/js/83.10352c38.js"><link rel="prefetch" href="/assets/js/84.8a6fab2c.js"><link rel="prefetch" href="/assets/js/85.ee9987ed.js"><link rel="prefetch" href="/assets/js/86.f89fad1c.js"><link rel="prefetch" href="/assets/js/87.44e47fe2.js"><link rel="prefetch" href="/assets/js/88.0863542b.js"><link rel="prefetch" href="/assets/js/89.928a3042.js"><link rel="prefetch" href="/assets/js/9.2250d602.js"><link rel="prefetch" href="/assets/js/90.ea6b407d.js"><link rel="prefetch" href="/assets/js/91.6e31a37f.js"><link rel="prefetch" href="/assets/js/92.f60fcb9f.js"><link rel="prefetch" href="/assets/js/93.3796cd61.js"><link rel="prefetch" href="/assets/js/94.fb3ea4ad.js"><link rel="prefetch" href="/assets/js/95.799e542d.js"><link rel="prefetch" href="/assets/js/96.207d2648.js"><link rel="prefetch" href="/assets/js/97.66fdd036.js"><link rel="prefetch" href="/assets/js/98.62e80ae4.js"><link rel="prefetch" href="/assets/js/99.b6f9c026.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea2dea0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Test in Javascript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Vue-testing-handbook
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Vue-testing-handbook
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest/" aria-current="page" class="sidebar-link">Jest</a></li><li><a href="/jest/introduction.html" class="sidebar-link">Pour commencer</a></li><li><a href="/jest/guides.html" class="sidebar-link">Tests instantanÃ©s</a></li><li><a href="/jest/framework.html" class="sidebar-link">Tester les Apps React</a></li><li><a href="/jest/api.html" class="sidebar-link">Les api gÃ©nÃ©rales</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tests-instantanes"><a href="#tests-instantanes" class="header-anchor">#</a> Tests instantanÃ©s</h1> <p>Les tests instantanÃ©s sont un outil trÃ¨s utile lorsque vous voulez vous assurer que votre UI ne change pas de maniÃ¨re inattendue.</p> <p>Un scÃ©nario de test snapshot typique rend un composant de l'interface utilisateur, prend un instantanÃ©, puis le compare Ã  un fichier snapshot de rÃ©fÃ©rence stockÃ© Ã  cÃ´tÃ© du test. Le test Ã©chouera si les deux instantanÃ©s ne correspondent pas : soit le changement est inattendu, soit l'instantanÃ© de rÃ©fÃ©rence doit Ãªtre mis Ã  jour avec la nouvelle version du composant de l'interface utilisateur.</p> <h2 id="test-instantane-avec-jest"><a href="#test-instantane-avec-jest" class="header-anchor">#</a> Test instantanÃ© avec Jest</h2> <p>Une approche similaire peut Ãªtre adoptÃ©e lorsqu'il s'agit de tester vos composants React. Au lieu de rendre l'interface graphique, ce qui nÃ©cessiterait de construire l'application entiÃ¨re, vous pouvez utiliser un moteur de rendu de test pour gÃ©nÃ©rer rapidement une valeur sÃ©rialisable pour votre arbre React. ConsidÃ©rez ce <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/__tests__/link.react.test.js" target="_blank" rel="noopener noreferrer">exemple de test<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour un <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Link.react.js" target="_blank" rel="noopener noreferrer">composant de lien<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'../Link.react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> renderer <span class="token keyword">from</span> <span class="token string">'react-test-renderer'</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.facebook.com&quot;</span><span class="token operator">&gt;</span>Facebook<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>La premiÃ¨re fois que ce test est effectuÃ©, Jest crÃ©e un [fichier instantanÃ©] (https://github.com/facebook/jest/blob/master/examples/snapshot/<strong>tests</strong>/<strong>snapshots</strong>/link.react.test.js.snap) qui ressemble Ã  ceci :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">renders correctly 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;a
  className=&quot;normal&quot;
  href=&quot;http://www.facebook.com&quot;
  onMouseEnter={[Function]}
  onMouseLeave={[Function]}
&gt;
  Facebook
&lt;/a&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>L'artefact instantanÃ© doit Ãªtre commis en mÃªme temps que les changements de code, et examinÃ© dans le cadre de votre processus de rÃ©vision du code. Jest utilise [pretty-format] (https://github.com/facebook/jest/tree/master/packages/pretty-format) pour rendre les instantanÃ©s lisibles par l'homme pendant la rÃ©vision du code. Lors des tests suivants, Jest compare la sortie rendue avec l'instantanÃ© prÃ©cÃ©dent. S'ils correspondent, le test sera rÃ©ussi. S'ils ne correspondent pas, soit le testeur a trouvÃ© un bug dans votre code (dans ce cas, c'est le composant <code>&lt;Link&gt;</code>) qui doit Ãªtre corrigÃ©, soit l'implÃ©mentation a changÃ© et l'instantanÃ© doit Ãªtre mis Ã  jour.</p> <blockquote><p>Note : L'instantanÃ© est directement liÃ© aux donnÃ©es que vous rendez - dans notre exemple, il s'agit du composant <code>&lt;Link /&gt;</code> avec le page prop qui lui est passÃ©. Cela implique que mÃªme si un autre fichier a des accessoires manquants (disons, <code>App.js</code>) dans le composant <code>&lt;Link /&gt;</code>, il passera quand mÃªme le test car le test ne connaÃ®t pas l'utilisation du composant <code>&lt;Link /&gt;</code> et il est seulement limitÃ© au composant <code>Link.react.js</code>. De plus, rendre le mÃªme composant avec des accessoires diffÃ©rents dans d'autres tests d'instantanÃ©s n'affectera pas le premier, car les tests ne se connaissent pas entre eux.</p></blockquote> <p>Vous trouverez plus d'informations sur le fonctionnement des tests instantanÃ©s et sur la raison pour laquelle nous les avons mis en place sur le [release blog post] (https://jestjs.io/blog/2016/07/27/jest-14.html). Nous vous recommandons de lire [ce billet] (http://benmccormick.org/2016/09/19/testing-with-jest-snapshots-first-impressions/) pour avoir une bonne idÃ©e du moment oÃ¹ vous devriez utiliser les tests d'instantanÃ©s. Nous vous recommandons Ã©galement de regarder cette [vidÃ©o egghead] (https://egghead.io/lessons/javascript-use-jest-s-snapshot-testing-feature?pl=testing-javascript-with-jest-a36c4074) sur le test instantanÃ© avec Jest.</p> <h3 id="mise-a-jour-des-instantanes"><a href="#mise-a-jour-des-instantanes" class="header-anchor">#</a> Mise Ã  jour des instantanÃ©s</h3> <p>Il est facile de repÃ©rer quand un test instantanÃ© Ã©choue aprÃ¨s l'introduction d'un bug. Lorsque cela se produit, corrigez le problÃ¨me et assurez-vous que vos tests instantanÃ©s sont Ã  nouveau rÃ©ussis. Maintenant, parlons du cas oÃ¹ un test instantanÃ© Ã©choue Ã  cause d'un changement intentionnel de l'implÃ©mentation.</p> <p>Une telle situation peut se produire si nous modifions intentionnellement l'adresse vers laquelle le composant Link de notre exemple pointe.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Cas test mis Ã  jour avec un lien vers une adresse diffÃ©rente</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;http://www.instagram.com&quot;</span><span class="token operator">&gt;</span>Instagram<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Dans ce cas, Jest imprimera cette sortie :</p> <p><img src="/img/content/failedSnapshotTest.png" alt=""></p> <p>Comme nous venons de mettre Ã  jour notre composant pour qu'il pointe vers une adresse diffÃ©rente, il est raisonnable de s'attendre Ã  des changements dans l'instantanÃ© de ce composant. Notre scÃ©nario de test de l'instantanÃ© Ã©choue parce que l'instantanÃ© de notre composant mis Ã  jour ne correspond plus Ã  l'artefact de l'instantanÃ© de ce scÃ©nario de test.</p> <p>Pour rÃ©soudre ce problÃ¨me, nous devrons mettre Ã  jour nos artefacts d'instantanÃ©. Vous pouvez lancer Jest avec un drapeau qui lui indiquera de gÃ©nÃ©rer Ã  nouveau des instantanÃ©s :</p> <div class="language-bash extra-class"><pre class="language-bash"><code>jest --updateSnapshot
</code></pre></div><p>Allez-y et acceptez les changements en exÃ©cutant la commande ci-dessus. Vous pouvez Ã©galement utiliser l'Ã©quivalent du drapeau <code>-u</code> Ã  un seul caractÃ¨re pour gÃ©nÃ©rer Ã  nouveau des instantanÃ©s si vous prÃ©fÃ©rez. Cela permettra de gÃ©nÃ©rer Ã  nouveau des artefacts d'instantanÃ©s pour tous les tests d'instantanÃ©s qui Ã©chouent. Si nous avions d'autres Ã©checs de tests d'instantanÃ©s Ã  cause d'un bug involontaire, nous aurions besoin de corriger le bug avant de re-gÃ©nÃ©rer des instantanÃ©s pour Ã©viter d'enregistrer des instantanÃ©s du comportement boguÃ©.</p> <p>Si vous souhaitez limiter les cas de tests snapshot Ã  re-gÃ©nÃ©rer, vous pouvez passer un drapeau supplÃ©mentaire <code>--testNamePattern</code> pour ne rÃ©-enregistrer des snapshots que pour les tests qui correspondent au pattern.</p> <p>Vous pouvez tester cette fonctionnalitÃ© en clonant le [snapshot example] (https://github.com/facebook/jest/tree/master/examples/snapshot), en modifiant le composant &quot;Link&quot; et en lanÃ§ant Jest.</p> <h3 id="mode-instantane-interactif"><a href="#mode-instantane-interactif" class="header-anchor">#</a> Mode instantanÃ© interactif</h3> <p>Les clichÃ©s ratÃ©s peuvent Ã©galement Ãªtre mis Ã  jour de maniÃ¨re interactive en mode veille :</p> <p><img src="/img/content/interactiveSnapshot.png" alt=""></p> <p>Une fois que vous entrez dans le mode instantanÃ© interactif, Jest vous fera passer les instantanÃ©s ratÃ©s un test Ã  la fois et vous donnera la possibilitÃ© de revoir les rÃ©sultats ratÃ©s.</p> <p>De lÃ , vous pouvez choisir de mettre Ã  jour cet instantanÃ© ou de passer au suivant :</p> <p><img src="/img/content/interactiveSnapshotUpdate.gif" alt=""></p> <p>Une fois que vous aurez terminÃ©, Jest vous donnera un rÃ©sumÃ© avant de revenir au mode de surveillance :</p> <p><img src="/img/content/interactiveSnapshotDone.png" alt=""></p> <h3 id="instantanes-en-ligne"><a href="#instantanes-en-ligne" class="header-anchor">#</a> InstantanÃ©s en ligne</h3> <p>Les instantanÃ©s en ligne se comportent de maniÃ¨re identique aux instantanÃ©s externes (fichiers &quot;snap&quot;), sauf que les valeurs des instantanÃ©s sont automatiquement rÃ©Ã©crites dans le code source. Cela signifie que vous pouvez bÃ©nÃ©ficier des avantages des instantanÃ©s gÃ©nÃ©rÃ©s automatiquement sans avoir Ã  passer Ã  un fichier externe pour vous assurer que la bonne valeur a Ã©tÃ© Ã©crite.</p> <blockquote><p>Les photos en ligne sont alimentÃ©es par [Prettier] (https://prettier.io). Pour utiliser les instantanÃ©s en ligne, vous devez avoir installÃ© <code>prettier</code> dans votre projet. Votre configuration Prettier sera respectÃ©e lors de l'Ã©criture des fichiers de test.</p> <p>Si vous avez installÃ© <code>prettier</code> dans un endroit oÃ¹ Jest ne peut pas le trouver, vous pouvez lui dire comment le trouver en utilisant la propriÃ©tÃ© de configuration <a href="/jest/Guides/Configuration.html#prettierpath-string"><code>&quot;prettierPath&quot;</code></a>.</p></blockquote> <p><strong>Exemple :</strong></p> <p>D'abord, vous Ã©crirez un test, en appelant <code>.toMatchInlineSnapshot()</code> sans arguments :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;https://prettier.io&quot;</span><span class="token operator">&gt;</span>Prettier<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>La prochaine fois que vous lancerez Jest, <code>tree</code> sera Ã©valuÃ©, et un snapshot sera Ã©crit en argument de <code>toMatchInlineSnapshot</code> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tree <span class="token operator">=</span> renderer
    <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Link page<span class="token operator">=</span><span class="token string">&quot;https://prettier.io&quot;</span><span class="token operator">&gt;</span>Prettier<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;a
  className=&quot;normal&quot;
  href=&quot;https://prettier.io&quot;
  onMouseEnter={[Function]}
  onMouseLeave={[Function]}
&gt;
  Prettier
&lt;/a&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>C'est tout ce qu'il y a Ã  faire ! Vous pouvez mÃªme mettre Ã  jour les snapshots avec <code>--updateSnapshot</code> ou en utilisant la touche <code>u</code> en mode <code>--watch</code>.</p> <h3 id="les-matchers-de-propriete"><a href="#les-matchers-de-propriete" class="header-anchor">#</a> Les matchers de propriÃ©tÃ©</h3> <p>Souvent, l'objet que vous souhaitez photographier comporte des champs qui sont gÃ©nÃ©rÃ©s (comme les ID et les dates). Si vous essayez de prendre un instantanÃ© de ces objets, ils forceront l'instantanÃ© Ã  Ã©chouer Ã  chaque exÃ©cution :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will fail every time'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'LeBron James'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will fail every time 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: 2018-05-19T23:36:09.816Z,
  &quot;id&quot;: 3,
  &quot;name&quot;: &quot;LeBron James&quot;,
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Pour ces cas, Jest permet de fournir un appariement asymÃ©trique pour n'importe quel bien. Ces correspondances sont vÃ©rifiÃ©es avant que l'instantanÃ© ne soit Ã©crit ou testÃ©, puis enregistrÃ©es dans le fichier de l'instantanÃ© au lieu de la valeur reÃ§ue :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will check the matchers and pass'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'LeBron James'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Number<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will check the matchers and pass 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: Any&lt;Date&gt;,
  &quot;id&quot;: Any&lt;Number&gt;,
  &quot;name&quot;: &quot;LeBron James&quot;,
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Toute valeur donnÃ©e qui n'est pas une correspondance sera vÃ©rifiÃ©e exactement et enregistrÃ©e dans l'instantanÃ© :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'will check the values and pass'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Bond... James Bond'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    createdAt<span class="token operator">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Bond... James Bond'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Snapshot</span>
exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">will check the values and pass 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
Object {
  &quot;createdAt&quot;: Any&lt;Date&gt;,
  &quot;name&quot;: 'Bond... James Bond',
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h2 id="meilleures-pratiques"><a href="#meilleures-pratiques" class="header-anchor">#</a> Meilleures pratiques</h2> <p>Les instantanÃ©s sont un outil fantastique pour identifier les changements d'interface inattendus au sein de votre application - que cette interface soit une rÃ©ponse API, une interface utilisateur, des journaux ou des messages d'erreur. Comme pour toute stratÃ©gie de test, il existe des bonnes pratiques que vous devez connaÃ®tre et des directives que vous devez suivre pour les utiliser efficacement.</p> <h3 id="_1-traiter-les-instantanes-comme-du-code"><a href="#_1-traiter-les-instantanes-comme-du-code" class="header-anchor">#</a> 1. Traiter les instantanÃ©s comme du code</h3> <p>Faites des instantanÃ©s et examinez-les dans le cadre de votre processus rÃ©gulier de rÃ©vision du code. Cela signifie que vous devez traiter les instantanÃ©s comme n'importe quel autre type de test ou de code dans votre projet.</p> <p>Assurez-vous que vos instantanÃ©s sont lisibles en les gardant concentrÃ©s, courts, et en utilisant des outils qui font respecter ces conventions stylistiques.</p> <p>Comme mentionnÃ© prÃ©cÃ©demment, Jest utilise <a href="https://yarnpkg.com/en/package/pretty-format" target="_blank" rel="noopener noreferrer"><code>pretty-format</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pour rendre les instantanÃ©s lisibles par l'homme, mais vous pouvez trouver utile d'introduire des outils supplÃ©mentaires, comme <a href="https://yarnpkg.com/en/package/eslint-plugin-jest" target="_blank" rel="noopener noreferrer"><code>eslint-plugin-jest</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> avec son option <a href="https://github.com/jest-community/eslint-plugin-jest/blob/master/docs/rules/no-large-snapshots.md" target="_blank" rel="noopener noreferrer"><code>no-large-snapshots</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, ou <a href="https://yarnpkg.com/en/package/snapshot-diff" target="_blank" rel="noopener noreferrer"><code>snapshot-diff</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> avec sa fonction de comparaison d'instantanÃ©s de composants, afin de promouvoir des affirmations courtes et ciblÃ©es.</p> <p>L'objectif est de faciliter l'examen des instantanÃ©s dans les requÃªtes pull, et de lutter contre l'habitude de rÃ©gÃ©nÃ©rer les instantanÃ©s lorsque les suites de test Ã©chouent au lieu d'examiner les causes profondes de leur Ã©chec.</p> <h3 id="_2-les-tests-doivent-etre-deterministes"><a href="#_2-les-tests-doivent-etre-deterministes" class="header-anchor">#</a> 2. Les tests doivent Ãªtre dÃ©terministes</h3> <p>Vos tests doivent Ãªtre dÃ©terministes. ExÃ©cuter les mÃªmes tests plusieurs fois sur un composant qui n'a pas changÃ© devrait produire les mÃªmes rÃ©sultats Ã  chaque fois. Vous devez vous assurer que les instantanÃ©s gÃ©nÃ©rÃ©s ne contiennent pas de donnÃ©es spÃ©cifiques Ã  la plate-forme ou d'autres donnÃ©es non dÃ©terministes.</p> <p>Par exemple, si vous avez un composant <a href="https://github.com/facebook/jest/blob/master/examples/snapshot/Clock.react.js" target="_blank" rel="noopener noreferrer">Clock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> qui utilise <code>Date.now()</code>, l'instantanÃ© gÃ©nÃ©rÃ© par ce composant sera diffÃ©rent Ã  chaque fois que le scÃ©nario de test sera exÃ©cutÃ©. Dans ce cas, nous pouvons <a href="/jest/Guides/MockFunctions.html">simuler la mÃ©thode Date.now()</a> pour renvoyer une valeur cohÃ©rente Ã  chaque fois que le test est exÃ©cutÃ© :</p> <div class="language-js extra-class"><pre class="language-js"><code>Date<span class="token punctuation">.</span>now <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1482363367071</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Maintenant, Ã  chaque fois que le scÃ©nario de test de l'instantanÃ© est exÃ©cutÃ©, <code>Date.now()</code> renverra <code>1482363367071</code> de maniÃ¨re cohÃ©rente. Cela aura pour consÃ©quence de gÃ©nÃ©rer le mÃªme instantanÃ© pour ce composant, quel que soit le moment oÃ¹ le test est exÃ©cutÃ©.</p> <h3 id="_3-utiliser-des-noms-d-instantanes-descriptifs"><a href="#_3-utiliser-des-noms-d-instantanes-descriptifs" class="header-anchor">#</a> 3. Utiliser des noms d'instantanÃ©s descriptifs</h3> <p>Essayez toujours d'utiliser des noms de tests descriptifs et/ou de clichÃ©s pour les instantanÃ©s. Les meilleurs noms dÃ©crivent le contenu attendu de l'instantanÃ©. Il est ainsi plus facile pour les examinateurs de vÃ©rifier les instantanÃ©s pendant l'examen, et pour quiconque de savoir si un instantanÃ© pÃ©rimÃ© est ou non le bon comportement avant la mise Ã  jour.</p> <p>Par exemple, comparer :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should handle some test case</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should handle some other test case</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>A L'adresse suivante :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render Alan Turing</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><p>Comme ce dernier dÃ©crit exactement ce qui est attendu dans le rÃ©sultat, il est plus clair de voir quand il est erronÃ© :</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div&gt;
  Alan Turing
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;UserName /&gt; should render Alan Turing</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">null</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h2 id="foire-aux-questions"><a href="#foire-aux-questions" class="header-anchor">#</a> Foire aux questions</h2> <h3 id="les-instantanes-sont-ils-ecrits-automatiquement-sur-les-systemes-d-integration-continue-ic"><a href="#les-instantanes-sont-ils-ecrits-automatiquement-sur-les-systemes-d-integration-continue-ic" class="header-anchor">#</a> Les instantanÃ©s sont-ils Ã©crits automatiquement sur les systÃ¨mes d'intÃ©gration continue (IC) ?</h3> <p>Non, Ã  partir de Jest 20, les snapshots dans Jest ne sont pas automatiquement Ã©crits lorsque Jest est exÃ©cutÃ© dans un systÃ¨me de CI sans passer explicitement par <code>--updateSnapshot</code>. On s'attend Ã  ce que tous les snapshots fassent partie du code qui est exÃ©cutÃ© sur le CI et comme les nouveaux snapshots passent automatiquement, ils ne devraient pas passer un test sur un systÃ¨me de CI. Il est recommandÃ© de toujours valider tous les instantanÃ©s et de les garder sous contrÃ´le de version.</p> <h3 id="faut-il-commettre-des-instantanes"><a href="#faut-il-commettre-des-instantanes" class="header-anchor">#</a> Faut-il commettre des instantanÃ©s ?</h3> <p>Oui, tous les fichiers d'instantanÃ©s doivent Ãªtre validÃ©s en mÃªme temps que les modules qu'ils couvrent et leurs tests. Ils doivent Ãªtre considÃ©rÃ©s comme faisant partie d'un test, tout comme la valeur de toute autre affirmation dans Jest. En fait, les instantanÃ©s reprÃ©sentent l'Ã©tat des modules sources Ã  un moment donnÃ©. De cette faÃ§on, lorsque les modules sources sont modifiÃ©s, Jest peut dire ce qui a changÃ© par rapport Ã  la version prÃ©cÃ©dente. Il peut Ã©galement fournir beaucoup de contexte supplÃ©mentaire pendant la rÃ©vision du code, dans lequel les rÃ©viseurs peuvent mieux Ã©tudier vos changements.</p> <h3 id="est-ce-que-les-tests-instantanes-ne-fonctionnent-qu-avec-les-composants-react"><a href="#est-ce-que-les-tests-instantanes-ne-fonctionnent-qu-avec-les-composants-react" class="header-anchor">#</a> Est-ce que les tests instantanÃ©s ne fonctionnent qu'avec les composants React ?</h3> <p>Les composants <a href="/jest/Guides/TutorialReact.html">React</a> et <a href="/jest/Guides/TutorialReactNative.html">React Native</a> sont un bon cas d'utilisation pour les tests d'instantanÃ©s. Cependant, les instantanÃ©s peuvent capturer n'importe quelle valeur sÃ©rialisable et doivent Ãªtre utilisÃ©s chaque fois que l'objectif est de tester si la sortie est correcte. Le dÃ©pÃ´t Jest contient de nombreux exemples de test de la sortie de Jest lui-mÃªme, de la sortie de la bibliothÃ¨que d'assertions de Jest ainsi que des messages de log de diverses parties de la base de code de Jest. Voir un exemple de <a href="https://github.com/facebook/jest/blob/master/e2e/__tests__/console.test.ts" target="_blank" rel="noopener noreferrer">snapshotting CLI output<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> dans le dÃ©pÃ´t Jest.</p> <h3 id="quelle-est-la-difference-entre-un-test-d-instantane-et-un-test-de-regression-visuelle"><a href="#quelle-est-la-difference-entre-un-test-d-instantane-et-un-test-de-regression-visuelle" class="header-anchor">#</a> Quelle est la diffÃ©rence entre un test d'instantanÃ© et un test de rÃ©gression visuelle ?</h3> <p>Les tests instantanÃ©s et les tests de rÃ©gression visuelle sont deux moyens distincts de tester les interfaces utilisateur, et ils servent des objectifs diffÃ©rents. Les outils de test de rÃ©gression visuelle prennent des captures d'Ã©cran de pages web et comparent les images rÃ©sultantes pixel par pixel. Avec le test Snapshot, les valeurs sont sÃ©rialisÃ©es, stockÃ©es dans des fichiers texte et comparÃ©es Ã  l'aide d'un algorithme de diffraction. Il y a diffÃ©rents compromis Ã  considÃ©rer et nous avons Ã©numÃ©rÃ© les raisons pour lesquelles les tests instantanÃ©s ont Ã©tÃ© construits dans le [Jest blog] (https://jestjs.io/blog/2016/07/27/jest-14.html#why-snapshot-testing).</p> <h3 id="les-tests-instantanes-remplacent-ils-les-tests-unitaires"><a href="#les-tests-instantanes-remplacent-ils-les-tests-unitaires" class="header-anchor">#</a> Les tests instantanÃ©s remplacent-ils les tests unitaires ?</h3> <p>Le test instantanÃ© n'est qu'une des 20 affirmations qui accompagnent Jest. L'objectif des tests instantanÃ©s n'est pas de remplacer les tests unitaires existants, mais d'apporter une valeur ajoutÃ©e et de rendre les tests indolores. Dans certains scÃ©narios, les tests instantanÃ©s peuvent potentiellement supprimer la nÃ©cessitÃ© de tests unitaires pour un ensemble particulier de fonctionnalitÃ©s (par exemple, les composants de rÃ©action), mais ils peuvent Ã©galement fonctionner ensemble.</p> <h3 id="quelles-sont-les-performances-des-tests-d-instantanes-en-ce-qui-concerne-la-vitesse-et-la-taille-des-fichiers-generes"><a href="#quelles-sont-les-performances-des-tests-d-instantanes-en-ce-qui-concerne-la-vitesse-et-la-taille-des-fichiers-generes" class="header-anchor">#</a> Quelles sont les performances des tests d'instantanÃ©s en ce qui concerne la vitesse et la taille des fichiers gÃ©nÃ©rÃ©s ?</h3> <p>Jest a Ã©tÃ© rÃ©Ã©crit dans un souci de performance, et les tests d'instantanÃ©s ne font pas exception. Comme les instantanÃ©s sont stockÃ©s dans des fichiers texte, cette mÃ©thode de test est rapide et fiable. Jest gÃ©nÃ¨re un nouveau fichier pour chaque fichier de test qui invoque le &quot;MatchSnapshot&quot;. La taille des snapshots est assez petite : Pour rÃ©fÃ©rence, la taille de tous les fichiers d'instantanÃ©s dans la base de code de Jest elle-mÃªme est infÃ©rieure Ã  300 Ko.</p> <h3 id="comment-resoudre-les-conflits-dans-les-fichiers-d-instantanes"><a href="#comment-resoudre-les-conflits-dans-les-fichiers-d-instantanes" class="header-anchor">#</a> Comment rÃ©soudre les conflits dans les fichiers d'instantanÃ©s ?</h3> <p>Les fichiers d'instantanÃ©s doivent toujours reprÃ©senter l'Ã©tat actuel des modules qu'ils couvrent. Par consÃ©quent, si vous fusionnez deux branches et que vous rencontrez un conflit dans les fichiers d'instantanÃ©s, vous pouvez soit rÃ©soudre le conflit manuellement, soit mettre Ã  jour le fichier d'instantanÃ©s en exÃ©cutant Jest et en inspectant le rÃ©sultat.</p> <h3 id="est-il-possible-d-appliquer-les-principes-de-developpement-pilote-par-les-tests-avec-des-tests-instantanes"><a href="#est-il-possible-d-appliquer-les-principes-de-developpement-pilote-par-les-tests-avec-des-tests-instantanes" class="header-anchor">#</a> Est-il possible d'appliquer les principes de dÃ©veloppement pilotÃ© par les tests avec des tests instantanÃ©s ?</h3> <p>Bien qu'il soit possible d'Ã©crire des fichiers d'instantanÃ©s manuellement, cela n'est gÃ©nÃ©ralement pas envisageable. Les instantanÃ©s aident Ã  dÃ©terminer si la sortie des modules couverts par les tests est modifiÃ©e, plutÃ´t que de donner des conseils pour concevoir le code en premier lieu.</p> <h3 id="la-couverture-de-code-fonctionne-t-elle-avec-les-tests-instantanes"><a href="#la-couverture-de-code-fonctionne-t-elle-avec-les-tests-instantanes" class="header-anchor">#</a> La couverture de code fonctionne-t-elle avec les tests instantanÃ©s ?</h3> <p>Oui, ainsi qu'avec tout autre test.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.24bc32f1.js" defer></script><script src="/assets/js/2.76e9c098.js" defer></script><script src="/assets/js/27.61521ef6.js" defer></script>
  </body>
</html>
