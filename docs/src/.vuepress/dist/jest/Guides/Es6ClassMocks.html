<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES6 Class Mocks | Test in Javascript</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Testing Vuejs and JS">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f1075b4d.css" as="style"><link rel="preload" href="/assets/js/app.1dfb11b9.js" as="script"><link rel="preload" href="/assets/js/2.76e9c098.js" as="script"><link rel="preload" href="/assets/js/21.be6446d5.js" as="script"><link rel="prefetch" href="/assets/js/10.bd6fd6a5.js"><link rel="prefetch" href="/assets/js/100.e4707484.js"><link rel="prefetch" href="/assets/js/101.e6d01fe0.js"><link rel="prefetch" href="/assets/js/102.03e4577c.js"><link rel="prefetch" href="/assets/js/103.533425bb.js"><link rel="prefetch" href="/assets/js/104.7866060c.js"><link rel="prefetch" href="/assets/js/105.c87ae376.js"><link rel="prefetch" href="/assets/js/106.1470de17.js"><link rel="prefetch" href="/assets/js/107.31d6eb75.js"><link rel="prefetch" href="/assets/js/108.8ab8ef28.js"><link rel="prefetch" href="/assets/js/109.f31541ff.js"><link rel="prefetch" href="/assets/js/11.1abf9ce7.js"><link rel="prefetch" href="/assets/js/110.7b3f1636.js"><link rel="prefetch" href="/assets/js/111.2f2eac6f.js"><link rel="prefetch" href="/assets/js/112.e118dccb.js"><link rel="prefetch" href="/assets/js/113.a8a30aa2.js"><link rel="prefetch" href="/assets/js/114.c9cd627f.js"><link rel="prefetch" href="/assets/js/115.a4796295.js"><link rel="prefetch" href="/assets/js/116.85cb9bc4.js"><link rel="prefetch" href="/assets/js/117.9857c369.js"><link rel="prefetch" href="/assets/js/118.fdd75f70.js"><link rel="prefetch" href="/assets/js/119.480af062.js"><link rel="prefetch" href="/assets/js/12.48bd50ee.js"><link rel="prefetch" href="/assets/js/120.0903be09.js"><link rel="prefetch" href="/assets/js/121.9e357b85.js"><link rel="prefetch" href="/assets/js/122.809a4b0c.js"><link rel="prefetch" href="/assets/js/123.e2038edd.js"><link rel="prefetch" href="/assets/js/124.4af8a9cc.js"><link rel="prefetch" href="/assets/js/125.b77a97ef.js"><link rel="prefetch" href="/assets/js/126.82f59f13.js"><link rel="prefetch" href="/assets/js/127.f41bdaff.js"><link rel="prefetch" href="/assets/js/128.5fca6b14.js"><link rel="prefetch" href="/assets/js/129.59147136.js"><link rel="prefetch" href="/assets/js/13.85e5e853.js"><link rel="prefetch" href="/assets/js/130.01fec4c9.js"><link rel="prefetch" href="/assets/js/131.bf32c3d1.js"><link rel="prefetch" href="/assets/js/132.5072c74e.js"><link rel="prefetch" href="/assets/js/133.e85de282.js"><link rel="prefetch" href="/assets/js/134.402e4e27.js"><link rel="prefetch" href="/assets/js/135.6dd89c1c.js"><link rel="prefetch" href="/assets/js/136.22ed1db4.js"><link rel="prefetch" href="/assets/js/137.72ab073c.js"><link rel="prefetch" href="/assets/js/138.c39958ee.js"><link rel="prefetch" href="/assets/js/139.1aa20bea.js"><link rel="prefetch" href="/assets/js/14.330cbcd9.js"><link rel="prefetch" href="/assets/js/140.c4b7b7a6.js"><link rel="prefetch" href="/assets/js/141.00a6b127.js"><link rel="prefetch" href="/assets/js/142.dc56159a.js"><link rel="prefetch" href="/assets/js/143.56bf7306.js"><link rel="prefetch" href="/assets/js/144.dc28faf5.js"><link rel="prefetch" href="/assets/js/145.58f42865.js"><link rel="prefetch" href="/assets/js/146.cdf5ac64.js"><link rel="prefetch" href="/assets/js/147.55bfcbbc.js"><link rel="prefetch" href="/assets/js/148.80f92bd1.js"><link rel="prefetch" href="/assets/js/149.d769487a.js"><link rel="prefetch" href="/assets/js/15.425a725c.js"><link rel="prefetch" href="/assets/js/150.f7925a0b.js"><link rel="prefetch" href="/assets/js/151.6218c5b9.js"><link rel="prefetch" href="/assets/js/152.41b5cfa0.js"><link rel="prefetch" href="/assets/js/153.05501cee.js"><link rel="prefetch" href="/assets/js/154.e86f3b62.js"><link rel="prefetch" href="/assets/js/155.1c63407d.js"><link rel="prefetch" href="/assets/js/156.c045d5cd.js"><link rel="prefetch" href="/assets/js/157.f6cea34d.js"><link rel="prefetch" href="/assets/js/158.7a808c51.js"><link rel="prefetch" href="/assets/js/159.b3b4561c.js"><link rel="prefetch" href="/assets/js/16.2062fdae.js"><link rel="prefetch" href="/assets/js/160.9d1f6278.js"><link rel="prefetch" href="/assets/js/161.cf4ec401.js"><link rel="prefetch" href="/assets/js/162.0047afe1.js"><link rel="prefetch" href="/assets/js/163.68d2b64d.js"><link rel="prefetch" href="/assets/js/164.ff770c4d.js"><link rel="prefetch" href="/assets/js/165.15d44e1b.js"><link rel="prefetch" href="/assets/js/166.0ffccc31.js"><link rel="prefetch" href="/assets/js/167.74e5cb83.js"><link rel="prefetch" href="/assets/js/168.3e987bc6.js"><link rel="prefetch" href="/assets/js/169.58a1c121.js"><link rel="prefetch" href="/assets/js/17.8ae89c4b.js"><link rel="prefetch" href="/assets/js/170.f5eb4958.js"><link rel="prefetch" href="/assets/js/171.de2ac02b.js"><link rel="prefetch" href="/assets/js/172.e723173f.js"><link rel="prefetch" href="/assets/js/173.ebe3373d.js"><link rel="prefetch" href="/assets/js/174.754bc705.js"><link rel="prefetch" href="/assets/js/175.68256c4c.js"><link rel="prefetch" href="/assets/js/176.0f54fcc6.js"><link rel="prefetch" href="/assets/js/177.eca24763.js"><link rel="prefetch" href="/assets/js/178.a53fc0b4.js"><link rel="prefetch" href="/assets/js/179.76c93623.js"><link rel="prefetch" href="/assets/js/18.2d051dd7.js"><link rel="prefetch" href="/assets/js/180.89a3951a.js"><link rel="prefetch" href="/assets/js/181.5545787b.js"><link rel="prefetch" href="/assets/js/182.44e30a17.js"><link rel="prefetch" href="/assets/js/183.98f27b20.js"><link rel="prefetch" href="/assets/js/184.8440af44.js"><link rel="prefetch" href="/assets/js/185.000aeddf.js"><link rel="prefetch" href="/assets/js/186.d6b8251b.js"><link rel="prefetch" href="/assets/js/187.31fa426e.js"><link rel="prefetch" href="/assets/js/188.58ccf322.js"><link rel="prefetch" href="/assets/js/189.c2ecd64b.js"><link rel="prefetch" href="/assets/js/19.7680ca75.js"><link rel="prefetch" href="/assets/js/190.6585dda4.js"><link rel="prefetch" href="/assets/js/191.ac09d6be.js"><link rel="prefetch" href="/assets/js/192.569eadde.js"><link rel="prefetch" href="/assets/js/193.dbc5d0c3.js"><link rel="prefetch" href="/assets/js/194.1ed49f10.js"><link rel="prefetch" href="/assets/js/195.73d17c86.js"><link rel="prefetch" href="/assets/js/196.38585136.js"><link rel="prefetch" href="/assets/js/197.80be5379.js"><link rel="prefetch" href="/assets/js/198.d2983630.js"><link rel="prefetch" href="/assets/js/199.c5b0eaae.js"><link rel="prefetch" href="/assets/js/20.92722f5a.js"><link rel="prefetch" href="/assets/js/200.d293a5ee.js"><link rel="prefetch" href="/assets/js/201.845153bc.js"><link rel="prefetch" href="/assets/js/202.c1a3aeac.js"><link rel="prefetch" href="/assets/js/203.fe05addc.js"><link rel="prefetch" href="/assets/js/22.68cd31e9.js"><link rel="prefetch" href="/assets/js/23.bdf61bc1.js"><link rel="prefetch" href="/assets/js/24.53cdec02.js"><link rel="prefetch" href="/assets/js/25.ebc52990.js"><link rel="prefetch" href="/assets/js/26.6c0a0e32.js"><link rel="prefetch" href="/assets/js/27.47a1acf9.js"><link rel="prefetch" href="/assets/js/28.9325d706.js"><link rel="prefetch" href="/assets/js/29.5805cc76.js"><link rel="prefetch" href="/assets/js/3.55e527b8.js"><link rel="prefetch" href="/assets/js/30.c432e70c.js"><link rel="prefetch" href="/assets/js/31.3b720485.js"><link rel="prefetch" href="/assets/js/32.8badbdd6.js"><link rel="prefetch" href="/assets/js/33.748d0532.js"><link rel="prefetch" href="/assets/js/34.c3eda56a.js"><link rel="prefetch" href="/assets/js/35.71847246.js"><link rel="prefetch" href="/assets/js/36.0611c91e.js"><link rel="prefetch" href="/assets/js/37.ba71a4af.js"><link rel="prefetch" href="/assets/js/38.ac6f30d4.js"><link rel="prefetch" href="/assets/js/39.58ba7a9e.js"><link rel="prefetch" href="/assets/js/4.bf905f50.js"><link rel="prefetch" href="/assets/js/40.26590aff.js"><link rel="prefetch" href="/assets/js/41.694f8d58.js"><link rel="prefetch" href="/assets/js/42.2d7d8d44.js"><link rel="prefetch" href="/assets/js/43.9cec6759.js"><link rel="prefetch" href="/assets/js/44.f7719b56.js"><link rel="prefetch" href="/assets/js/45.939a097b.js"><link rel="prefetch" href="/assets/js/46.9eb035b4.js"><link rel="prefetch" href="/assets/js/47.717699f5.js"><link rel="prefetch" href="/assets/js/48.e2a83d9e.js"><link rel="prefetch" href="/assets/js/49.0f4a38a5.js"><link rel="prefetch" href="/assets/js/5.44066470.js"><link rel="prefetch" href="/assets/js/50.09b9cedf.js"><link rel="prefetch" href="/assets/js/51.ca236e5a.js"><link rel="prefetch" href="/assets/js/52.8ab1dd65.js"><link rel="prefetch" href="/assets/js/53.4950b2fa.js"><link rel="prefetch" href="/assets/js/54.6c28a1ae.js"><link rel="prefetch" href="/assets/js/55.203bfda1.js"><link rel="prefetch" href="/assets/js/56.feea9280.js"><link rel="prefetch" href="/assets/js/57.bbd935c4.js"><link rel="prefetch" href="/assets/js/58.98b7e31b.js"><link rel="prefetch" href="/assets/js/59.11977924.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/60.fef4549b.js"><link rel="prefetch" href="/assets/js/61.5cac46d9.js"><link rel="prefetch" href="/assets/js/62.96cd90d5.js"><link rel="prefetch" href="/assets/js/63.66c5a79a.js"><link rel="prefetch" href="/assets/js/64.57532410.js"><link rel="prefetch" href="/assets/js/65.d081c48d.js"><link rel="prefetch" href="/assets/js/66.cfb836a0.js"><link rel="prefetch" href="/assets/js/67.7b4dd45f.js"><link rel="prefetch" href="/assets/js/68.e7ebbee9.js"><link rel="prefetch" href="/assets/js/69.68324175.js"><link rel="prefetch" href="/assets/js/7.a00e933e.js"><link rel="prefetch" href="/assets/js/70.27518c57.js"><link rel="prefetch" href="/assets/js/71.7a58fc57.js"><link rel="prefetch" href="/assets/js/72.08c01f3b.js"><link rel="prefetch" href="/assets/js/73.1d2fa4b2.js"><link rel="prefetch" href="/assets/js/74.a06f107c.js"><link rel="prefetch" href="/assets/js/75.ac9e2bd1.js"><link rel="prefetch" href="/assets/js/76.899208f6.js"><link rel="prefetch" href="/assets/js/77.0f1d0c65.js"><link rel="prefetch" href="/assets/js/78.8a73a4c3.js"><link rel="prefetch" href="/assets/js/79.e2db69cb.js"><link rel="prefetch" href="/assets/js/8.d194c183.js"><link rel="prefetch" href="/assets/js/80.b61d7063.js"><link rel="prefetch" href="/assets/js/81.a82b5e62.js"><link rel="prefetch" href="/assets/js/82.9a5b8058.js"><link rel="prefetch" href="/assets/js/83.10352c38.js"><link rel="prefetch" href="/assets/js/84.ccacae49.js"><link rel="prefetch" href="/assets/js/85.ee9987ed.js"><link rel="prefetch" href="/assets/js/86.f89fad1c.js"><link rel="prefetch" href="/assets/js/87.44e47fe2.js"><link rel="prefetch" href="/assets/js/88.94dfbf30.js"><link rel="prefetch" href="/assets/js/89.04227930.js"><link rel="prefetch" href="/assets/js/9.2250d602.js"><link rel="prefetch" href="/assets/js/90.7a82ea28.js"><link rel="prefetch" href="/assets/js/91.4a625cbe.js"><link rel="prefetch" href="/assets/js/92.29d2fcc3.js"><link rel="prefetch" href="/assets/js/93.3223892e.js"><link rel="prefetch" href="/assets/js/94.7584ac0d.js"><link rel="prefetch" href="/assets/js/95.75db5c06.js"><link rel="prefetch" href="/assets/js/96.bf62c5a6.js"><link rel="prefetch" href="/assets/js/97.66fdd036.js"><link rel="prefetch" href="/assets/js/98.c9d329be.js"><link rel="prefetch" href="/assets/js/99.b6f9c026.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f1075b4d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Test in Javascript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vue-test-utils/" class="nav-link">
  Vue-Test-Utils
</a></div><div class="nav-item"><a href="/vue-testing-handbook/" class="nav-link">
  Le manuel de lmiller1990
</a></div><div class="nav-item"><a href="/jest/" class="nav-link router-link-active">
  Jest
</a></div><div class="nav-item"><a href="/mocha/" class="nav-link">
  Mocha
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Jest</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jest/" aria-current="page" class="sidebar-link">Jest</a></li><li><a href="/jest/introduction.html" class="sidebar-link">Pour commencer</a></li><li><a href="/jest/guides.html" class="sidebar-link">Tests instantanés</a></li><li><a href="/jest/framework.html" class="sidebar-link">Tester les Apps React</a></li><li><a href="/jest/api.html" class="sidebar-link">Les api générales</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="les-classes-es6-fictives"><a href="#les-classes-es6-fictives" class="header-anchor">#</a> Les classes ES6 fictives</h1> <p>Jest peut-être utilisé pour simuler les classes ES6 qui sont importées dans les fichiers que vous voulez tester.</p> <p>Les classes ES6 sont des fonctions de construction avec un peu de sucre syntaxique. Par conséquent, toute simulation d'une classe ES6 doit être une fonction d'une classe ES6 réelle (qui est, encore une fois, une autre fonction). Vous pouvez donc les simuler en utilisant des <a href="/jest/Guides/MockFunctions.html">fonctions simulées</a></p> <h2 id="un-exemple-de-classe-es6"><a href="#un-exemple-de-classe-es6" class="header-anchor">#</a> Un exemple de classe ES6</h2> <p>Nous utiliserons un exemple inventé d'une classe qui joue des fichiers sonores, <code>SoundPlayer</code>, et une classe de consommateurs qui utilise cette classe, <code>SoundPlayerConsumer</code>. Nous simulerons <code>SoundPlayer</code> dans nos tests pour <code>SoundPlayerConsumer</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// sound-player.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SoundPlayer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">playSoundFile</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Playing sound file '</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// sound-player-consumer.js</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SoundPlayerConsumer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>soundPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">'song.mp3'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>soundPlayer<span class="token punctuation">.</span><span class="token function">playSoundFile</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="les-4-facons-de-creer-une-simulation-de-classe-es6"><a href="#les-4-facons-de-creer-une-simulation-de-classe-es6" class="header-anchor">#</a> Les 4 façons de créer une simulation de classe ES6</h2> <h3 id="simulation-automatique"><a href="#simulation-automatique" class="header-anchor">#</a> Simulation automatique</h3> <p>Appeler <code>jest.mock('./sound-player')</code> renvoie un &quot;mock automatique&quot; utile que vous pouvez utiliser pour espionner les appels au constructeur de la classe et toutes ses méthodes. Il remplace la classe ES6 par un constructeur fictif, et remplace toutes ses méthodes par des <a href="/jest/Guides/MockFunctions.html">fonctions fictives</a> qui retournent toujours <code>undefined</code>. Les appels de méthodes sont enregistrés dans <code>theAutomaticMock.mock.instances[index].methodName.mock.calls</code>.</p> <p>Veuillez noter que si vous utilisez des fonctions flèches dans vos classes, elles ne feront <em>pas</em> partie de la simulation. La raison en est que les fonctions flèches ne sont pas présentes sur le prototype e l'objet, il s'agit simplement de propriétés contenant une référence à une fonction.</p> <p>Si vous n'avez pas besoin de remplacer l'implémentation de la classe, c'est l'option la plus facile à mettre en place. Par exemple :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">'./sound-player-consumer'</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SoundPlayer est désormais un constructeur fictif</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// Effacer toutes les instances et appels au constructeur et toutes les méthodes :</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called the class constructor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called a method on the class instance'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Montrer que mockClear() fonctionne :</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Le constructeur aurait dû être rappelé :</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">'song.mp3'</span><span class="token punctuation">;</span>
  soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// mock.instances est disponible avec des maquettes automatiques :</span>
  <span class="token keyword">const</span> mockSoundPlayerInstance <span class="token operator">=</span> SoundPlayer<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> mockSoundPlayerInstance<span class="token punctuation">.</span>playSoundFile<span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Equivalent à la vérification ci-dessus :</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="simulation-manuelle"><a href="#simulation-manuelle" class="header-anchor">#</a> Simulation manuelle</h3> <p>Créez une [maquette manuelle] (ManualMocks.md) en enregistrant une implémentation de la simulation dans le dossier <code>__mocks__</code>. Cela vous permet de spécifier l'implémentation, et elle peut être utilisée dans tous les fichiers de test.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// __mocks__/sound-player.js</span>

<span class="token comment">// Importez cette exportation nommée dans votre fichier test :</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mock <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> mock<span class="token punctuation">;</span>
</code></pre></div><p>Importez la simulation et la méthode de la simulation partagés par toutes les instances :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// sound-player-consumer.test.js</span>
<span class="token keyword">import</span> SoundPlayer<span class="token punctuation">,</span> <span class="token punctuation">{</span>mockPlaySoundFile<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">'./sound-player-consumer'</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SoundPlayer est désormais un constructeur fictif</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Effacer toutes les instances et appels au constructeur et toutes les méthodes :</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called the class constructor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called a method on the class instance'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">'song.mp3'</span><span class="token punctuation">;</span>
  soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="appeler-jest-mock-avec-le-parametre-d-usine-du-module"><a href="#appeler-jest-mock-avec-le-parametre-d-usine-du-module" class="header-anchor">#</a> Appeler <a href="/jest/Guides/JestObjectAPI.html#jestmockmodulename-factory-options"><code>jest.mock()</code></a> avec le paramètre d'usine du module</h3> <p><code>jest.mock(path, moduleFactory)</code> prend un argument de <strong>module factory</strong>. Une usine de modules est une fonction qui renvoie la simulation.</p> <p>Afin de simuler une fonction de constructeur, la fabrique de modules doit retourner une fonction de constructeur. En d'autres termes, la fabrique de modules doit être une fonction qui renvoie une fonction - une fonction d'ordre supérieur (HOF).</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Une limitation avec le paramètre d'usine est que, puisque les appels à <code>jest.mock()</code> sont hissés au sommet du fichier, il n'est pas possible de définir d'abord une variable et de l'utiliser ensuite dans l'usine. Une exception est faite pour les variables qui commencent par le mot &quot;mock&quot;. C'est à vous de garantir qu'elles seront initialisées à temps ! Par exemple, voici un exemple d'erreur hors champ due à l'utilisation de &quot;fake&quot; au lieu de &quot;mock&quot; dans la déclaration de la variable :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Note: ce sera un échec</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fakePlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> fakePlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="remplacement-de-la-simulation-en-utilisant-mockimplementation-ou-mockimplementationonce"><a href="#remplacement-de-la-simulation-en-utilisant-mockimplementation-ou-mockimplementationonce" class="header-anchor">#</a> Remplacement de la simulation en utilisant <a href="/jest/Guides/MockFunctionAPI.html#mockfnmockimplementationfn"><code>mockImplementation()</code></a> ou <a href="/jest/Guides/MockFunctionAPI.html#mockfnmockimplementationoncefn"><code>mockImplementationOnce()</code></a></h3> <p>Vous pouvez remplacer toutes les simulations ci-dessus afin de modifier l'implémentation, pour un seul test ou pour tous les tests, en appelant <code>mockImplementation()</code> sur la simulation existante.</p> <p>Les appels à jest.mock sont placés en haut du code. Vous pouvez spécifier un objet fictif plus tard, par exemple dans <code>beforeAll()</code>, en appelant <code>mockImplementation()</code> (ou <code>mockImplementationOnce()</code>) sur l'objet fictif existant au lieu d'utiliser le paramètre d'usine. Cela vous permet également de changer la simulation entre les tests, si nécessaire :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">'./sound-player-consumer'</span><span class="token punctuation">;</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'When SoundPlayer throws an error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    SoundPlayer<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">playSoundFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Test error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Should throw an error when calling playSomethingCool'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="en-profondeur-comprendre-les-fonctions-du-constructeur-fictif"><a href="#en-profondeur-comprendre-les-fonctions-du-constructeur-fictif" class="header-anchor">#</a> En profondeur : Comprendre les fonctions du constructeur fictif</h2> <p>La construction de votre fonction de construction fictive en utilisant <code>jest.fn().mockImplementation()</code> fait paraître les ficelles plus compliquées qu'elles ne le sont en réalité. Cette section montre comment vous pouvez créer vos propres simulations pour illustrer le fonctionnement de la simulation.</p> <h3 id="simulation-manuelle-qui-est-une-autre-classe-es6"><a href="#simulation-manuelle-qui-est-une-autre-classe-es6" class="header-anchor">#</a> Simulation manuelle qui est une autre classe ES6</h3> <p>Si vous définissez une classe ES6 en utilisant le même nom de fichier que la classe fantaisie dans le dossier <code>__mocks__</code>, elle servira de fantaisie. Cette classe sera utilisée à la place de la classe réelle. Cela vous permet d'injecter une implémentation de test pour la classe, mais ne fournit pas de moyen d'espionner les appels.</p> <p>Pour l'exemple inventé, le mock pourrait ressembler à ceci :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// __mocks__/sound-player.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SoundPlayer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mock SoundPlayer: constructor was called'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">playSoundFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mock SoundPlayer: playSoundFile was called'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="maquette-utilisant-le-parametre-d-usine-du-module"><a href="#maquette-utilisant-le-parametre-d-usine-du-module" class="header-anchor">#</a> Maquette utilisant le paramètre d'usine du module</h3> <p>La fonction module factory passée à <code>jest.mock(path, moduleFactory)</code> peut être un HOF qui renvoie une fonction*. Cela permettra d'appeler <code>new</code> sur le mock. Encore une fois, cela permet d'injecter un comportement différent pour les tests, mais ne permet pas d'espionner les appels.</p> <h4 id="la-fonction-d-usine-du-module-doit-renvoyer-une-fonction"><a href="#la-fonction-d-usine-du-module-doit-renvoyer-une-fonction" class="header-anchor">#</a> * La fonction d'usine du module doit renvoyer une fonction</h4> <p>Afin de simuler une fonction de constructeur, l'usine de modules doit renvoyer une fonction de constructeur. En d'autres termes, la fabrique de modules doit être une fonction qui renvoie une fonction - une fonction d'ordre supérieur (HOF).</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token function-variable function">playSoundFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong><em>Note: Les fonctions fléchées  ne fonctionnent pas</em></strong></p> <p>Notez que la simulation ne peut pas être une fonction fléchée car l'appel de &quot;nouveau&quot; sur une fonction flèchée n'est pas autorisé en JavaScript. Cela ne fonctionnera donc pas :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Ne fonctionne pas ; les fonctions fléchées ne peuvent pas être appelées avec de nouvelles</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token function-variable function">playSoundFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cela entraînera une erreur de type <strong><em>TypeError : _soundPlayer2.default n'est pas un constructor</em></strong>, sauf si le code est transposé à ES5, par exemple par <code>@babel/preset-env</code>. (ES5 n'a pas de fonctions de flèches ni de classes, donc les deux seront transposées en fonctions simples).</p> <h2 id="garder-une-trace-de-l-utilisation-espionnage-du-simulacre"><a href="#garder-une-trace-de-l-utilisation-espionnage-du-simulacre" class="header-anchor">#</a> Garder une trace de l'utilisation (espionnage du simulacre)</h2> <p>L'injection d'une implémentation de test est utile, mais vous voudrez probablement aussi tester si le constructeur de classe et les méthodes sont appelés avec les bons paramètres.</p> <h3 id="espionner-le-constructeur"><a href="#espionner-le-constructeur" class="header-anchor">#</a> Espionner le constructeur</h3> <p>Afin de suivre les appels au constructeur, remplacez la fonction renvoyée par le HOF par une fonction fictive Jest. Créez-la avec <a href="/jest/Guides/JestObjectAPI.html#jestfnimplementation"><code>jest.fn()</code></a>, puis spécifiez son implémentation avec <code>mockImplementation()</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fonctionne et vous permet de vérifier les appels des constructeurs :</span>
  <span class="token keyword">return</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token function-variable function">playSoundFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cela nous permettra d'inspecter l'utilisation de notre classe fictive, en utilisant <code>SoundPlayer.mock.calls</code> : <code>expect(SoundPlayer).toHaveBeenCalled();</code> ou quasi-équivalent : <code>expect(SoundPlayer.mock.calls.length).toEqual(1);</code>.</p> <h3 id="se-moquer-des-exportations-hors-classe-de-defaut"><a href="#se-moquer-des-exportations-hors-classe-de-defaut" class="header-anchor">#</a> Se moquer des exportations hors classe de défaut</h3> <p>Si la classe est <strong>not</strong> l'exportation par défaut du module, vous devez renvoyer un objet avec la clé qui est la même que le nom de l'exportation de la classe.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>SoundPlayer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fonctionne et vous permet de vérifier les appels des constructeurs :</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    SoundPlayer<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token function-variable function">playSoundFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="espionner-les-methodes-de-notre-classe"><a href="#espionner-les-methodes-de-notre-classe" class="header-anchor">#</a> Espionner les méthodes de notre classe</h3> <p>Notre classe simulée devra fournir toutes les fonctions membres (<code>playSoundFile</code> dans l'exemple) qui seront appelées pendant nos tests, sinon nous obtiendrons une erreur pour avoir appelé une fonction qui n'existe pas. Mais nous voudrons probablement aussi espionner les appels à ces méthodes, pour nous assurer qu'elles ont été appelées avec les paramètres attendus.</p> <p>Un nouvel objet sera créé à chaque fois que la fonction de constructeur fictif sera appelée pendant les tests. Pour espionner les appels de méthode dans tous ces objets, nous remplissons <code>playSoundFile</code> avec une autre fonction fantaisie, et nous stockons une référence à cette même fonction fantaisie dans notre fichier de test, afin qu'elle soit disponible pendant les tests.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Nous pouvons maintenant suivre les appels à playSoundFile</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>L'équivalent manuel simulé serait :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// __mocks__/sound-player.js</span>

<span class="token comment">// Importez cette exportation nommée dans votre fichier test</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mock <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> mock<span class="token punctuation">;</span>
</code></pre></div><p>L'utilisation est similaire à la fonction d'usine du module, sauf que vous pouvez omettre le second argument de <code>jest.mock()</code>, et vous devez importer la méthode fantaisie dans votre fichier de test, puisqu'elle n'y est plus définie. Utilisez pour cela le chemin d'accès original du module ; n'incluez pas <code>__mocks__</code>.</p> <h3 id="nettoyage-entre-les-tests"><a href="#nettoyage-entre-les-tests" class="header-anchor">#</a> Nettoyage entre les tests</h3> <p>Pour nettoyer l'enregistrement des appels à la fonction du constructeur fictif et à ses méthodes, nous appelons <a href="/jest/Guides/MockFunctionAPI.html#mockfnmockclear"><code>mockClear()</code></a> dans la fonction <code>beforeEach()</code> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="exemple-complet"><a href="#exemple-complet" class="header-anchor">#</a> Exemple complet</h2> <p>Voici un fichier de test complet qui utilise le paramètre d'usine du module pour <code>jest.mock</code> :</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// sound-player-consumer.test.js</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">'./sound-player-consumer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">'./sound-player'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./sound-player'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>playSoundFile<span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'The consumer should be able to call new() on SoundPlayer'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// S'assurer que le constructeur a créé l'objet :</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>soundPlayerConsumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called the class constructor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'We can check if the consumer called a method on the class instance'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">'song.mp3'</span><span class="token punctuation">;</span>
  soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1dfb11b9.js" defer></script><script src="/assets/js/2.76e9c098.js" defer></script><script src="/assets/js/21.be6446d5.js" defer></script>
  </body>
</html>
